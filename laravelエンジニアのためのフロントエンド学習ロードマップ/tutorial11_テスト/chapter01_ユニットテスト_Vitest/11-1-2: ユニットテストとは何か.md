# 11-1-2: ユニットテストとは何か

## 🎯 このセクションで学ぶこと

-   ユニットテストの定義と目的を理解する
-   ユニットテストのメリット（品質向上、リファクタリングの容易化、仕様の文書化）を学ぶ
-   どのような対象（純粋関数、カスタムフック、UIコンポーネント）にユニットテストを書くべきかを理解する

## 導入

テストピラミッドの土台をなすのが**ユニットテスト（単体テスト）**です。ユニットテストは、アプリケーションを構成する最小単位（ユニット）が、それぞれ個別に正しく動作することを検証するテストです。

フロントエンド開発における「ユニット」とは、主に以下のものを指します。

-   **関数**: 特定の計算やデータ変換を行う純粋関数など。
-   **カスタムフック**: 複数のコンポーネントで再利用されるロジックをカプセル化したフック。
-   **UIコンポーネント**: propsを受け取り、特定のUIを描画するコンポーネント単体。

ユニットテストでは、これらのユニットを他の部分から切り離し、独立した環境でテストします。例えば、API通信を行うコンポーネントをテストする場合、実際にネットワークリクエストを発生させるのではなく、「モック」と呼ばれる偽のAPI関数を用意して、テストを安定かつ高速に実行します。

## ユニットテストのメリット

なぜユニットテストを書くのでしょうか？主なメリットは以下の3つです。

### 1. 品質の向上とデグレードの防止

ユニットテストは、バグを開発サイクルの早い段階で発見するのに役立ちます。コードを変更した際にテストを実行すれば、その変更が意図しない副作用（デグレード）を引き起こしていないかを即座に確認できます。これにより、開発者は自信を持ってコードを修正・追加していくことができます。

### 2. 安全なリファクタリング

「リファクタリング」とは、外部から見た振る舞いを変えずに、内部のコード構造を改善することです。例えば、読みにくいコードを分かりやすく書き換えたり、パフォーマンスを改善したりします。

ユニットテストがあれば、リファクタリング後もコンポーネントが期待通りに動作し続けていることを保証できます。テストというセーフティネットがあるおかげで、開発者は恐れることなくコードの改善に取り組むことができます。

### 3. 仕様の文書化（ドキュメントとしての役割）

よく書かれたテストコードは、そのユニットがどのように動作するべきかを示す「生きたドキュメント」になります。

```typescript
// 例: 消費税を計算する関数のテスト

it("税率10%で正しく消費税を計算できる", () => {
  expect(calculateTax(1000)).toBe(100);
});

it("金額が0円の場合は消費税も0円になる", () => {
  expect(calculateTax(0)).toBe(0);
});
```

このテストコードを読めば、`calculateTax`関数がどのような入力に対してどのような出力を返すことを期待されているのかが、コメントやドキュメントを読むよりも正確に理解できます。新しい開発者がプロジェクトに参加した際にも、テストコードは仕様を理解するための大きな助けとなります。

## 何をテストするべきか？

すべてのコードに対してユニットテストを書くのは現実的ではありません。ユニットテストは、特に以下のようなロジックが複雑な部分や、アプリケーションのコアとなる部分に重点的に書くのが効果的です。

-   **純粋関数**: 複雑な計算、データ整形、バリデーションロジックなど、副作用のない関数はユニットテストに最適です。
-   **カスタムフック**: 複数のコンポーネントで共有される状態ロジックや副作用のロジックは、バグの影響範囲が広いため、テストで品質を担保する価値が高いです。
-   **UIコンポーネント**: propsに応じて表示が切り替わる、ユーザーのアクション（クリックなど）によって状態が変化するなど、条件分岐が多いコンポーネントはテストの恩恵を受けやすいです。

一方で、ただ静的なテキストを表示するだけの単純なコンポーネントや、外部ライブラリそのものの機能（例: `fetch`が動くかどうか）をテストする必要はありません。

## ✨ まとめ

-   ユニットテストは、関数やコンポーネントといったアプリケーションの最小単位を個別に検証するテストである。
-   主なメリットは、「品質向上」「安全なリファクタリング」「仕様の文書化」の3つ。
-   ロジックが複雑な純粋関数やカスタムフック、条件分岐が多いUIコンポーネントなどがユニットテストの主な対象となる。

次のセクションでは、このユニットテストを実装するためのツール「Vitest」の基本的な使い方を学びます。

# 2-2-3: 詳細度（Specificity）の基礎

## 🎯 このセクションで学ぶこと

- CSSの**詳細度（Specificity）**の概念を理解する
- 複数のスタイルが競合した場合、どのスタイルが適用されるかを予測できるようになる
- 詳細度を意識した保守しやすいCSSを書けるようになる

## 導入

前のセクションでセレクタの種類を学びました。しかし、同じ要素に複数のスタイルが適用された場合、どのスタイルが優先されるのでしょうか？

```css
p {
  color: blue;
}

.text {
  color: red;
}

#intro {
  color: green;
}
```

```html
<p class="text" id="intro">この文字は何色？</p>
```

この場合、文字は**緑色**になります。なぜでしょうか？その答えが「**詳細度（Specificity）**」です。

## 詳細度とは

**詳細度**とは、CSSのセレクタがどれだけ「具体的」かを数値で表したものです。複数のスタイルが同じ要素に適用される場合、詳細度が高いセレクタのスタイルが優先されます。

> **💡 比喩で理解:** 詳細度は「住所の詳しさ」に例えられます。「日本」より「東京都」、「東京都」より「東京都渋谷区」の方が具体的です。CSSも同様に、より具体的なセレクタが優先されます。

## 詳細度の計算方法

詳細度は**4つの桁**で計算されます。左の桁ほど優先度が高くなります。

| 桁 | 対象 | 例 |
|:---|:---|:---|
| **1桁目** | インラインスタイル | `style="..."` |
| **2桁目** | IDセレクタ | `#header` |
| **3桁目** | クラス、属性、擬似クラス | `.card`, `[type="text"]`, `:hover` |
| **4桁目** | 要素、擬似要素 | `div`, `p`, `::before` |

### 計算例

| セレクタ | 詳細度 | 解説 |
|:---|:---|:---|
| `p` | 0-0-0-1 | 要素セレクタ1つ |
| `.card` | 0-0-1-0 | クラスセレクタ1つ |
| `#header` | 0-1-0-0 | IDセレクタ1つ |
| `p.text` | 0-0-1-1 | 要素1 + クラス1 |
| `#header .nav a` | 0-1-1-1 | ID1 + クラス1 + 要素1 |
| `style="..."` | 1-0-0-0 | インラインスタイル |

### 詳細度の比較

詳細度は**左から順に比較**します。左の桁が大きい方が優先されます。

```
0-1-0-0 > 0-0-10-0  （IDセレクタ1つ > クラスセレクタ10個）
0-0-1-0 > 0-0-0-10  （クラスセレクタ1つ > 要素セレクタ10個）
```

> **⚠️ 注意:** クラスセレクタをいくつ重ねても、IDセレクタ1つには勝てません。同様に、要素セレクタをいくつ重ねても、クラスセレクタ1つには勝てません。

## 🏃 実践: 詳細度を確認する

実際にコードを書いて、詳細度の動作を確認しましょう。

### Step 1: HTMLを作成

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>詳細度の確認</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <p class="text" id="intro">この文字は何色になるでしょうか？</p>
</body>
</html>
```

### Step 2: CSSを作成

```css
/* 詳細度: 0-0-0-1 */
p {
  color: blue;
}

/* 詳細度: 0-0-1-0 */
.text {
  color: red;
}

/* 詳細度: 0-1-0-0 */
#intro {
  color: green;
}
```

### Step 3: 結果を確認

ブラウザで確認すると、文字は**緑色**になります。

**理由:** `#intro`（0-1-0-0）が最も詳細度が高いため、緑色が適用されます。

### Step 4: 詳細度を変えてみる

CSSを以下のように変更してみましょう。

```css
/* 詳細度: 0-0-0-1 */
p {
  color: blue;
}

/* 詳細度: 0-0-1-1 */
p.text {
  color: red;
}

/* 詳細度: 0-0-1-0 */
.text {
  color: orange;
}
```

この場合、文字は**赤色**になります。`p.text`（0-0-1-1）が最も詳細度が高いためです。

## 同じ詳細度の場合

詳細度が同じ場合は、**後に書かれたスタイルが優先**されます（カスケード）。

```css
.text {
  color: blue;
}

.text {
  color: red;  /* こちらが適用される */
}
```

## `!important` について

`!important`を使うと、詳細度を無視してスタイルを強制適用できます。

```css
p {
  color: blue !important;  /* 最優先で適用される */
}

#intro {
  color: green;  /* 無視される */
}
```

> **⚠️ 注意:** `!important`は**最後の手段**です。多用すると、どのスタイルが適用されているか分からなくなり、保守が困難になります。実務では、詳細度を適切に管理することで`!important`を使わずに済むようにしましょう。

## 詳細度のベストプラクティス

### 1. IDセレクタは避ける

IDセレクタは詳細度が高すぎるため、後からスタイルを上書きしにくくなります。

```css
/* ❌ 避ける */
#header {
  background: blue;
}

/* ✅ 推奨 */
.header {
  background: blue;
}
```

### 2. セレクタはシンプルに保つ

セレクタを深くネストすると、詳細度が上がりすぎて管理が困難になります。

```css
/* ❌ 避ける（詳細度が高すぎる） */
.header .nav .menu .item .link {
  color: blue;
}

/* ✅ 推奨（シンプル） */
.nav-link {
  color: blue;
}
```

### 3. BEM記法を活用する

**BEM（Block Element Modifier）**記法を使うと、詳細度を低く保ちながら、意味のあるクラス名を付けられます。

```css
/* BEM記法の例 */
.card { }           /* Block */
.card__title { }    /* Element */
.card--featured { } /* Modifier */
```

> **💡 TIP:** Tailwind CSSを使う場合、詳細度の問題はほとんど発生しません。Tutorial 3で詳しく学びます。

## 開発者ツールで詳細度を確認する

ブラウザの開発者ツール（F12）を使うと、どのスタイルが適用されているか、なぜ上書きされているかを確認できます。

1. 要素を右クリック →「検証」を選択
2. 「Styles」タブで適用されているスタイルを確認
3. 取り消し線が引かれているスタイルは、より詳細度の高いスタイルに上書きされています

## よくある間違いと対処法

### 問題: スタイルが適用されない

```css
.card {
  color: blue;
}
```

```html
<div id="card" class="card">テキスト</div>
```

別の場所で`#card`にスタイルが指定されている場合、クラスセレクタのスタイルは適用されません。

**対処法:**
1. 開発者ツールで競合しているスタイルを確認
2. IDセレクタを使っている場合は、クラスセレクタに変更
3. どうしても上書きできない場合のみ、詳細度を上げる

## ✨ まとめ

- **詳細度**は、セレクタの「具体性」を数値で表したもの
- 詳細度は「インライン > ID > クラス > 要素」の順で高い
- 同じ詳細度の場合、**後に書かれたスタイルが優先**される
- `!important`は最後の手段。多用は避ける
- **IDセレクタは避け、クラスセレクタを使う**のがベストプラクティス

## 📝 学習のポイント

- [ ] 詳細度の概念を説明できる
- [ ] 詳細度の計算方法を理解している
- [ ] 複数のスタイルが競合した場合、どれが適用されるか予測できる
- [ ] 開発者ツールで詳細度を確認できる
- [ ] 詳細度を意識したCSSを書ける

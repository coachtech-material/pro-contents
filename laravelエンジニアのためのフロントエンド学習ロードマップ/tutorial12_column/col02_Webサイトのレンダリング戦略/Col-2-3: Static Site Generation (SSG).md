# Col-2-3: Static Site Generation (SSG)

## 🎯 このセクションで学ぶこと

-   静的サイト生成（SSG）の基本的な仕組みを理解する。
-   SSGのメリット（最高のパフォーマンス、セキュリティ、低コスト）とデメリット（ビルド時間、動的コンテンツへの対応）を学ぶ。
-   SSGがどのようなサイトに適しているかを理解する。

## 導入

サーバーサイドレンダリング（SSR）はリクエストごとにHTMLを生成しますが、もしページの内容が全ユーザー共通で、頻繁に更新されないのであれば、毎回レンダリングするのは非効率です。この課題を解決するのが、**静的サイト生成（Static Site Generation, SSG）**です。

SSGは、**ビルド時**（サイトをデプロイする前）にすべてのページのHTMLをあらかじめ生成しておくアプローチです。Next.js、Gatsby、Astroといったモダンなフレームワークで広くサポートされており、「Jamstack」アーキテクチャの中核をなす技術です。[1]

## SSGの仕組み

SSGでは、開発者がコードをプッシュしたり、デプロイコマンドを実行したりするタイミングで、サイト内のすべてのページがレンダリングされ、静的なHTMLファイルとして出力されます。これらのファイルは、CDN（Content Delivery Network）に配置されるのが一般的です。

SSGの処理フローは以下のようになります。

1.  **Build Time**: 開発者がサイトをビルドします。
2.  **Fetch Data & Render HTML**: ビルドプロセスの中で、フレームワーク（Next.jsなど）は必要なデータを外部APIやローカルのMarkdownファイルから取得し、サイト内のすべてのページ（例: `/`, `/about`, `/posts/1`, `/posts/2`...）のHTMLを生成します。
3.  **Deploy to CDN**: 生成された静的ファイル（HTML, CSS, JS, 画像）一式が、CDNなどの静的ホスティングサービスにデプロイされます。
4.  **User Request**: ユーザーがURLにアクセスすると、リクエストは最も近いCDNのエッジサーバーに送られます。
5.  **Instant HTML Response**: CDNは、すでに生成済みのHTMLファイルを即座にユーザーに返します。サーバーサイドでの計算は一切不要です。
6.  **Hydration**: SSRと同様に、ブラウザはJavaScriptをダウンロード・実行し、静的なページにインタラクティブ性を付与します（ハイドレーション）。

![SSGの処理フロー](https://raw.githubusercontent.com/coachtech-material/pro-contents/main/laravel%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E5%AD%A6%E7%BF%92%E3%83%AD%E3%83%BC%E3%83%89%E3%83%9E%E3%83%83%E3%83%97/images/column/ssg-flow.png)

## SSGのメリット

### 1. 最高のパフォーマンス

SSGは、考えられる中で**最も高速なレンダリング手法**です。リクエスト時にサーバーでの処理が一切なく、完成品のHTMLがCDNから直接配信されるため、TTFB（Time to First Byte）は極めて短くなります。これにより、FCPも非常に高速になります。

> 静的サイト生成（SSG）は、リクエスト時にサーバーがページを生成する必要がないため、最速のレンダリング方法です。代わりに、コンテンツはビルド時に生成され、CDN にキャッシュされて、最高のパフォーマンスを実現します。
> --- Vercel, "What is Static Site Generation?" [2]

### 2. 高いセキュリティと信頼性

配信されるのは静的なファイルだけなので、サーバーサイドの脆弱性を突くような攻撃（データベースインジェクションなど）のリスクが大幅に低減します。また、サーバーサイドのランタイムやデータベースに依存しないため、システムが非常に安定しており、ダウンタイムのリスクも低いです。

### 3. 低コストでスケーラブル

静的ファイルのホスティングは、動的なサーバーを運用するよりもはるかに安価です。VercelやNetlify、Cloudflare Pagesなどのプラットフォームでは、無料または非常に低コストでサイトを公開できます。また、CDNを利用することで、世界中からの大量のアクセスにも容易にスケールさせることができます。

## SSGのデメリット

### 1. ビルド時間

SSGの最大の課題は、サイトの規模が大きくなるにつれて**ビルド時間が長くなる**ことです。数万ページもあるような大規模なサイトでは、少しの修正をデプロイするだけでも、すべてのページを再生成するために数分から数十分かかることがあります。これは、開発のイテレーション速度を低下させる要因となります。

### 2. 動的コンテンツへの対応

SSGは、ビルド時に内容が確定している静的なコンテンツには最適ですが、ユーザーごとにパーソナライズされた情報や、頻繁に更新されるリアルタイムのデータを表示するのは苦手です。これらの動的な要素を表示するには、ページが読み込まれた後にクライアントサイドのJavaScriptでAPIを叩くなど、CSR的なアプローチを組み合わせる必要があります。

## SSGが適しているサイト

上記のメリット・デメリットを考慮すると、SSGは以下のようなサイトに適しています。

-   **ブログやドキュメンテーションサイト**: コンテンツの更新頻度がそれほど高くなく、パフォーマンスとSEOが重要なサイト。
-   **マーケティングサイトやポートフォリオ**: 内容が比較的静的で、高速な表示が求められるサイト。
-   **小〜中規模のECサイトの商品一覧ページ**: 商品情報が頻繁に変わらない場合。

## ✨ まとめ

-   SSGは、ビルド時にすべてのページのHTMLをあらかじめ生成しておく方式。
-   **メリット**: 最高のパフォーマンス、高いセキュリティ、低コストでスケーラブル。
-   **デメリット**: サイト規模に応じたビルド時間の増大、動的コンテンツへの対応が別途必要。
-   ブログやドキュメンテーションなど、コンテンツが比較的静的で、パフォーマンスが最優先されるサイトに適している。

SSGのビルド時間の問題を解決しつつ、静的サイトのメリットを享受するためのハイブリッドなアプローチが、次に紹介する**ISR（Incremental Static Regeneration）**です。

---

## 参考文献

[1] Smashing Magazine. (2020, May 26). *A Complete Introduction To Jamstack*. Retrieved from https://www.smashingmagazine.com/2020/05/jamstack-introduction/

[2] Vercel. (n.d.). *What is Static Site Generation?*. Retrieved from https://vercel.com/docs/getting-started-with-vercel/concepts/rendering#static-site-generation-ssg

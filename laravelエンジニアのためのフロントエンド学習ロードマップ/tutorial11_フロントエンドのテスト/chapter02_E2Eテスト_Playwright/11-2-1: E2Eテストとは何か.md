# 11-2-1: E2Eテストとは何か

## 🎯 このセクションで学ぶこと

-   E2E（End-to-End）テストの定義と目的を理解する
-   E2Eテストがなぜ重要なのか、ユニットテストとの違いは何かを学ぶ
-   E2Eテストで検証するべき代表的なユーザーシナリオの例を理解する

## 導入

テストピラミッドの頂点に位置するのが**E2E（End-to-End）テスト**です。E2Eテストは、アプリケーション全体を、実際のユーザーと同じように操作して、一連の機能が正しく連携して動作するかを検証するテストです。「エンドツーエンド」とは、文字通り「端から端まで」を意味し、ユーザーインターフェース（フロントエンド）からデータベース（バックエンド）まで、システム全体を貫通するテストを指します。

ユニットテストが個々の部品（関数やコンポーネント）の動作を保証するのに対し、E2Eテストはそれらの部品がすべて組み合わさった状態で、**ユーザーの視点から**期待通りに機能するかを検証します。

## なぜE2Eテストが必要なのか？

「すべてのユニットテストが成功しているのに、実際にアプリを動かすと機能しない」という経験はありませんか？これは、各部品は正しくても、部品間の連携（データの受け渡し、APIの呼び出し、画面遷移など）に問題がある場合に発生します。

E2Eテストは、このような「統合」に関する問題を発見するための最も効果的な手法です。

### E2Eテストの主な目的

-   **主要なユーザーフローの保証**: ログイン、商品購入、記事投稿など、ビジネスにとって重要度の高い一連のユーザー操作（クリティカルパス）が正常に完了することを保証します。
-   **デプロイ前の最終確認**: 本番環境にリリースする前の「最後の砦」として、アプリケーション全体が健全な状態であることを確認します。
-   **リグレッションの広範囲な検出**: フロントエンドの変更がバックエンドに、あるいはその逆の変更がフロントエンドに予期せぬ影響を与えていないかを検出します。

## E2Eテスト vs ユニットテスト

| 観点 | E2Eテスト | ユニットテスト |
| :--- | :--- | :--- |
| **スコープ** | アプリケーション全体 | 関数やコンポーネント単体 |
| **視点** | ユーザー視点（ブラックボックステスト） | 開発者視点（ホワイトボックステスト） |
| **実行環境** | 実際のブラウザ | Node.js上の仮想DOM（jsdomなど） |
| **実行速度** | 遅い | 速い |
| **問題の特定** | 難しい（どこが原因か分かりにくい） | 容易（テスト対象が明確） |
| **信頼性** | 高い（実際に近い環境でテストする） | 低い（モックに依存することがある） |

E2Eテストは、実行に時間がかかり、失敗した際の原因特定も難しいという欠点があります。そのため、テストピラミッドが示すように、数は絞り、アプリケーションの最も重要な機能（コアなユーザーストーリー）に焦点を当てて作成するのが一般的です。

## E2Eテストのシナリオ例

E2Eテストでは、以下のような具体的なユーザーシナリオをテストコードとして記述します。

-   **認証フロー**
    1.  トップページにアクセスする
    2.  ログインボタンをクリックする
    3.  ログインページで、有効なユーザー名とパスワードを入力して送信する
    4.  ダッシュボードページにリダイレクトされ、「ようこそ、〇〇さん」と表示されることを確認する
    5.  ログアウトボタンをクリックする
    6.  トップページに戻り、ログインボタンが表示されていることを確認する

-   **ECサイトの商品購入フロー**
    1.  商品一覧ページにアクセスする
    2.  特定の商品をクリックして詳細ページに移動する
    3.  「カートに入れる」ボタンをクリックする
    4.  カートページに移動し、商品が追加されていることを確認する
    5.  「購入手続きへ」ボタンをクリックし、決済を完了させる

このように、E2Eテストは「ユーザーが何を達成したいのか」というストーリーに基づいています。

## ✨ まとめ

-   E2Eテストは、ユーザー視点でアプリケーション全体の動作を端から端まで検証するテストである。
-   ユニットテストでは発見できない、コンポーネント間やフロントエンド・バックエンド間の連携の問題を発見するのに役立つ。
-   実行コストが高いため、ログインや商品購入など、ビジネス上重要なユーザーストーリーに絞って作成するのが効果的である。

次のセクションでは、このE2Eテストを実装するための強力なツール「Playwright」の基本的な使い方を学びます。

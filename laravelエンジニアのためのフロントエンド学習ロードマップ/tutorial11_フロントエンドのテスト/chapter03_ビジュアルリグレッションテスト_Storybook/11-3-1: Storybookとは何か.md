# 11-3-1: Storybookとは何か

## 🎯 このセクションで学ぶこと

-   Storybookの定義と目的を理解する
-   Storybookが解決する課題（UIコンポーネントの開発とテストの効率化）を学ぶ
-   ビジュアルリグレッションテストの概念と、Storybookがどのように役立つかを理解する

## 導入

[Storybook](https://storybook.js.org/)は、UIコンポーネントをアプリケーション本体から切り離し、独立した環境で開発・確認・テストするためのツールです。コンポーネントの一つ一つを「物語（Story）」のページのように一覧化し、カタログのように閲覧できることからこの名前がついています。

![StorybookのUI](https://raw.githubusercontent.com/coachtech-material/pro-contents/main/laravel%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E5%AD%A6%E7%BF%92%E3%83%AD%E3%83%BC%E3%83%89%E3%83%9E%E3%83%83%E3%83%97/images/tutorial-11/storybook-ui.png)

Storybookは単なるコンポーネントビューアではありません。UI開発のハブとして、以下のような多くの利点をもたらします。

-   **分離された開発環境**: アプリケーション全体のビジネスロジックやルーティング、API通信などを気にすることなく、UIコンポーネントの見た目とインタラクションだけに集中して開発できます。
-   **コンポーネントカタログ**: プロジェクトに存在するコンポーネントが一覧化され、どのようなコンポーネントがあるのか、それぞれがどのような見た目や状態（props）を持つのかが一目瞭然になります。これにより、デザイナーとエンジニア間のコミュニケーションが円滑になり、コンポーネントの再利用も促進されます。
-   **多様な状態のシミュレーション**: `primary`なボタン、`disabled`なボタン、エラー状態のテキストフィールドなど、コンポーネントが取りうる様々な状態（バリエーション）を簡単に再現し、確認できます。
-   **テストとの連携**: Storybookは、ユニットテスト、E2Eテスト、そして特に**ビジュアルリグレッションテスト**と強力に連携します。

## ビジュアルリグレッションテストとは？

ビジュアルリグレッションテスト（Visual Regression Testing, VRT）は、「見た目の回帰テスト」です。コードの変更によって、意図せずUIの見た目が変わってしまっていないかを検出するのが目的です。

テストの基本的な流れは以下の通りです。

1.  **基準（Baseline）画像の作成**: 正常な状態のコンポーネントのスクリーンショットを撮り、「正解」の画像として保存します。
2.  **比較画像の作成**: コードを変更した後、同じコンポーネントのスクリーンショットを再度撮影します。
3.  **差分の検出**: 基準画像と比較画像をピクセル単位で比較し、差分がないかをチェックします。
4.  **結果の確認**: もし差分があれば、テストは失敗します。開発者はその差分が意図したものか（例: デザイン変更）、意図しないものか（例: バグ）を確認し、必要であれば基準画像を更新します。

### なぜVRTが重要なのか？

ユニットテストやE2Eテストは、主に「機能」が壊れていないかを検証します。例えば、「ボタンをクリックしたら、`onClick`ハンドラが呼ばれるか」はテストできますが、「ボタンの角丸が消えてしまった」や「テキストの色が変わってしまった」といった**見た目の変化**を検出するのは困難です。

CSSの変更は、意図しない場所に影響を及ぼすことがよくあります。VRTを導入することで、こうした「見た目のデグレード（リグレッション）」を自動で検出し、UIの品質を一貫して高く保つことができます。

## StorybookとVRT

Storybookは、VRTと非常に相性が良いツールです。なぜなら、Storybookはコンポーネントの様々な状態を分離してカタログ化しているため、VRTのテストケースを体系的に作成するのに最適だからです。

-   `Button/Primary`のStory
-   `Button/Secondary`のStory
-   `Button/Disabled`のStory

といった各Storyに対してスクリーンショットを撮影することで、コンポーネントのあらゆる状態の見た目を網羅的にテストできます。

Storybook自体はVRTの機能を持っていませんが、[Chromatic](https://www.chromatic.com/)（Storybookのメンテナーが開発）や[Percy](https://percy.io/)、あるいはPlaywrightと組み合わせることで、VRTを実現できます。

## ✨ まとめ

-   Storybookは、UIコンポーネントを分離された環境で開発・確認・テストするためのツールである。
-   コンポーネントカタログとして機能し、チーム内のコミュニケーションを円滑にする。
-   ビジュアルリグレッションテスト（VRT）は、UIの「見た目」が意図せず変わっていないかを自動で検出するテスト手法である。
-   Storybookは、コンポーネントの様々な状態をカタログ化しているため、VRTと非常に相性が良い。

次のセクションでは、実際にNext.jsプロジェクトにStorybookを導入し、基本的な使い方を学びます。

# 9-1-3: App_Routerによるファイルベースルーティング

## Chapter 1: Next.jsの基本とルーティング

### Section 3: App Routerによるファイルベースルーティング

🎯 **このセクションで学ぶこと**

-   Next.jsのApp Routerが、**ファイルシステムの構造に基づいてルーティングを行う**仕組みを理解する。
-   フォルダを作成して新しいルート（例: `/about`）を作成できるようになる。
-   `Link`コンポーネントを使って、ページ間をクライアントサイドで遷移する方法を習得する。
-   動的ルート（例: `/posts/[id]`）を作成し、URLのパラメータを取得できるようになる。

--- 

### イントロダクション：ファイルを作るだけでページができる

React Routerのようなライブラリでは、ルートとコンポーネントのマッピングをコードで定義する必要がありました。しかし、Next.jsのApp Routerでは、**`app`ディレクトリ内のファイルとフォルダの構造が、そのままアプリケーションのURL構造になります**。これを**ファイルベースルーティング**と呼びます。

この仕組みにより、設定ファイルなしで、直感的にページの追加や変更ができます。

--- 

### 🚀 静的ルートの作成

新しいページを作成するのは非常に簡単です。`app`ディレクトリ内に新しい**フォルダ**を作成し、その中に`page.tsx`という名前のファイルを追加するだけです。

#### 例：`/about`ページの作成

1.  `src/app`ディレクトリ内に`about`という名前の新しいフォルダを作成します。
2.  作成した`about`フォルダの中に、`page.tsx`というファイルを作成します。

```
src/
└── app/
    ├── about/
    │   └── page.tsx  // これが /about のページになる
    ├── layout.tsx
    └── page.tsx      // これが / のページになる
```

3.  `src/app/about/page.tsx`に、Reactコンポーネントを記述します。

```tsx
// src/app/about/page.tsx

export default function AboutPage() {
  return (
    <main>
      <h1>About Us</h1>
      <p>このページは会社概要ページです。</p>
    </main>
  );
}
```

これだけで、`http://localhost:3000/about`にアクセスすると、作成した`AboutPage`コンポーネントが表示されます。簡単ですね！

--- 

### 🔗 `Link`コンポーネントによるページ遷移

ページ間の移動には、HTMLの`<a>`タグの代わりに、Next.jsが提供する`Link`コンポーネントを使用します。

**なぜ`<a>`タグではダメなのか？**
`<a>`タグを使うと、ブラウザはページ全体をリロードしてしまいます。これは、従来のWebサイトと同じ挙動で、SPA（シングルページアプリケーション）の利点である「高速な画面遷移」が失われてしまいます。

**`Link`コンポーネントの利点**
`Link`コンポーネントは、以下の賢い動作を自動的に行います。

-   **クライアントサイドナビゲーション**: ページ全体をリロードせず、JavaScriptが差分のコンポーネントだけを描画するため、非常に高速な遷移が実現されます。
-   **プリフェッチ**: ビューポート（画面表示領域）に入った`Link`コンポーネントの遷移先ページを、バックグラウンドで自動的に先読み（プリフェッチ）します。これにより、ユーザーがリンクをクリックした瞬間に、ページの表示がほぼ完了している状態になります。

#### 例：トップページからAboutページへのリンク

`src/app/page.tsx`を編集して、`/about`へのリンクを追加しましょう。

```tsx
// src/app/page.tsx
import Link from "next/link"; // Linkコンポーネントをインポート

export default function HomePage() {
  return (
    <main>
      <h1>Welcome to Next.js!</h1>
      <p>これはトップページです。</p>
      
      <Link href="/about">
        Aboutページへ
      </Link>
    </main>
  );
}
```

ブラウザでトップページを表示し、「Aboutページへ」のリンクをクリックしてみてください。ページがリロードされることなく、瞬時にAboutページに切り替わるのがわかるはずです。

--- 

### ⚙️ 動的ルートセグメント

ブログの記事ページ（`/posts/1`, `/posts/2`）や、ユーザーのプロフィールページ（`/users/taro`, `/users/jiro`）のように、URLの一部が動的に変わるページを作成したい場合も多いでしょう。App Routerでは、**角括弧 `[]`** を使ってフォルダ名やファイル名を付けることで、**動的ルートセグメント**を定義できます。

#### 例：`/posts/[id]`ページの作成

1.  `src/app`内に`posts`フォルダを作成します。
2.  `posts`フォルダ内に、`[id]`という名前のフォルダを作成します。（`id`の部分は任意の名前でOKです）
3.  `[id]`フォルダ内に、`page.tsx`を作成します。

```
src/
└── app/
    └── posts/
        └── [id]/
            └── page.tsx  // これが /posts/1, /posts/abc などにマッチする
```

4.  `src/app/posts/[id]/page.tsx`を編集します。

動的ルートコンポーネントは、`params`という特別なPropsを受け取ります。この`params`オブジェクトの中に、URLの動的な部分が格納されています。

```tsx
// src/app/posts/[id]/page.tsx

// コンポーネントは params という名前のpropsを受け取る
// { params: { id: '1' } } のようなオブジェクトが渡される
export default function PostDetailPage({ params }: { params: { id: string } }) {
  return (
    <main>
      <h1>記事詳細ページ</h1>
      <p>この記事のIDは: {params.id} です。</p>
    </main>
  );
}
```

これで、`http://localhost:3000/posts/1`にアクセスすれば「この記事のIDは: 1 です。」と表示され、`http://localhost:3000/posts/hello-world`にアクセスすれば「この記事のIDは: hello-world です。」と表示されます。

--- 

✨ **まとめ**

-   App Routerでは、`app`ディレクトリ内の**フォルダ構造がURLに対応**する。
-   新しいページを追加するには、フォルダを作成し、その中に`page.tsx`を配置する。
-   ページ間の高速な遷移には、`<a>`タグの代わりに**`Link`コンポーネント**を使用する。
-   フォルダ名を**角括弧 `[slug]`** で囲むことで、動的なURLセグメント（例: `/posts/1`）を扱う**動的ルート**を作成できる。
-   動的ルートのコンポーネントは、`params` PropsからURLの動的な値を取得できる。

📝 **学習のポイント**

-   [ ] `/dashboard/settings` というURLのページを作成するには、どのようなディレクトリ構造にすればよいでしょうか？
-   [ ] `Link`コンポーネントに`prefetch={false}`という属性を追加すると、どのような挙動の変化が起こるか調べてみましょう。
-   [ ] `/shop/[category]/[itemId]` のように、複数の動的セグメントを持つルートを作成することは可能でしょうか？ その場合、コンポーネントが受け取る`params`オブジェクトはどのような形になるか予想してみましょう。

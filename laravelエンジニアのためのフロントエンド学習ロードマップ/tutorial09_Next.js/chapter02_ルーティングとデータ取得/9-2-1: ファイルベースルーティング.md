# 9-2-1: ファイルベースルーティング

## 🎯 このセクションで学ぶこと

- Next.js App Routerのファイルベースルーティングの基本的な仕組みを理解する
- フォルダ構造がどのようにURLパスに対応するかを学ぶ
- ルートを公開するために必要な`page.tsx`ファイルの役割を理解する
- ネストされたルート（Nested Routes）を作成する方法を習得する
- ルートセグメントを整理するためのルートグループ（Route Groups）について学ぶ

## 導入

Next.jsの最も強力で直感的な機能の一つが、**ファイルベースルーティング**です。これは、アプリケーションのURL構造が、ファイルシステムのフォルダ構造に直接マッピングされるという考え方です。

Laravelのようなフレームワークでは、`routes/web.php`のようなファイルにルート定義を明示的に記述する必要がありました。

```php
// Laravelのルート定義例
Route::get("/dashboard", [DashboardController::class, "index"]);
Route::get("/users/{id}", [UserController::class, "show"]);
```

一方、Next.jsでは、`app`ディレクトリ内にフォルダを作成するだけで、自動的にルートが生成されます。これにより、ルート定義ファイルを見なくても、フォルダ構造を見るだけでアプリケーション全体のURL構造を把握することができます。

## 詳細解説

### 🔑 基本的な考え方

App Routerでは、`app`ディレクトリ内の**フォルダ**を使ってURLのセグメントを定義します。そして、そのフォルダ内に`page.tsx`（または`.js`, `.jsx`）という名前のファイルを作成することで、そのURLパスが公開され、アクセス可能になります。

-   **フォルダ**: URLのパスを定義します。
-   **`page.tsx`**: そのパスにアクセスしたときに表示されるUIを定義するReactコンポーネントです。

#### 例：

-   `app/page.tsx` → `/`
-   `app/dashboard/page.tsx` → `/dashboard`
-   `app/dashboard/settings/page.tsx` → `/dashboard/settings`

`page.tsx`ファイルがないフォルダは、それ自体は公開されたルートにはならず、単にURLセグメントを構成するための中間フォルダとして機能します。

### フォルダ構造とURLのマッピング

| ファイルシステムのパス | 対応するURLパス |
| :--- | :--- |
| `app/page.tsx` | `/` |
| `app/about/page.tsx` | `/about` |
| `app/blog/page.tsx` | `/blog` |
| `app/blog/2024/first-post/page.tsx` | `/blog/2024/first-post` |

### ネストされたルート (Nested Routes)

フォルダをネストさせることで、階層的なルートを簡単に作成できます。例えば、ブログ機能を作成する場合を考えてみましょう。

```
app/
├── blog/                  # /blog セグメント
│   ├── page.tsx            # /blog のページ
│   ├── layout.tsx          # /blog とその子ルートに適用されるレイアウト
│   └── [slug]/             # /blog/:slug の動的セグメント (次のセクションで解説)
│       └── page.tsx        # /blog/some-post のページ
└── page.tsx                # / (ルート) のページ
```

この構造では、`/blog`というパスと、その配下に個別のブログ記事ページ（例: `/blog/my-first-post`）が存在することを示しています。

### レイアウトとの連携

ファイルベースルーティングは、`layout.tsx`と密接に連携します。特定のフォルダ内に`layout.tsx`を配置すると、そのレイアウトはそのフォルダ内の`page.tsx`と、すべての**子孫ルート**に適用されます。

上記の例では、`app/blog/layout.tsx`は`/blog`ページと`/blog/[slug]`ページの両方に適用され、共通のヘッダーやサイドバーなどを提供できます。これにより、特定のセクションだけで共通のUIを簡単に実現できます。

### 🗂️ ルートグループ (Route Groups)

URL構造に影響を与えずに、ルートセグメント（フォルダ）を整理したい場合があります。例えば、マーケティング関連のページ（`/about`, `/contact`）と、アプリケーション内のページ（`/dashboard`, `/settings`）をフォルダレベルで分けて管理したいが、URLにその管理用のフォルダ名（例: `/marketing/about`）は含めたくない、というケースです。

このような場合、フォルダ名を括弧 `()` で囲むことで**ルートグループ**を作成できます。括弧で囲まれたフォルダ名はURLパスから完全に無視されます。

#### 例：

```
app/
├── (marketing)/          # URLに影響しないグループ
│   ├── about/
│   │   └── page.tsx        # → /about
│   └── contact/
│       └── page.tsx        # → /contact
├── (app)/
│   ├── dashboard/
│   │   └── page.tsx        # → /dashboard
│   └── settings/
│       └── page.tsx        # → /settings
└── page.tsx
```

ルートグループは、特定のセクションごとに異なるレイアウトを適用したい場合にも非常に便利です。例えば、`(marketing)`グループのルートにのみ適用される`layout.tsx`を`(marketing)/layout.tsx`に配置できます。

## ✨ まとめ

-   Next.js App Routerでは、**フォルダ構造がそのままURL構造になる**ファイルベースルーティングを採用している。
-   各フォルダ内に`page.tsx`ファイルを作成することで、そのルートが公開され、UIが定義される。
-   フォルダをネストさせることで、直感的に階層的なルートを構築できる。
-   フォルダ名を括弧`()`で囲む**ルートグループ**を使うと、URLパスに影響を与えずにルートを整理したり、セクションごとに異なるレイアウトを適用したりできる。
-   この仕組みにより、ルート定義が不要になり、アプリケーションの全体像が把握しやすくなる。

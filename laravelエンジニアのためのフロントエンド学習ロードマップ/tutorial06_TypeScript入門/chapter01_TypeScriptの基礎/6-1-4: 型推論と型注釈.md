# 6-1-4: 型推論と型注釈

## 🎯 このセクションで学ぶこと

- TypeScriptの強力な機能である**型推論**がどのように機能するかを理解する
- **型注釈**を使って、意図的に型を明示する方法を習得する
- 型推論と型注釈をどのような場面で使い分けるべきかの判断基準を学ぶ

## 導入

TypeScriptは、コードに型を付けることで静的解析を可能にし、開発段階で多くのエラーを防ぎます。しかし、すべての変数や関数に手動で型を記述する必要があるとしたら、コードは非常に冗長になってしまいます。

そこで登場するのが**型推論（Type Inference）**と**型注釈（Type Annotation）**です。TypeScriptは、開発者が明示的に型を指定しなくても、文脈から型を自動的に推測する賢い仕組みを持っています。このセクションでは、これらの基本的ながら非常に重要な概念を学び、TypeScriptのコードをより効率的かつ安全に書く方法を習得します。

## 詳細解説

### 🔑 型推論 (Type Inference)

型推論は、TypeScriptコンパイラがコードの文脈から変数の型を自動的に決定する機能です。主に、変数を宣言と同時に初期化した場合に機能します。

```typescript
// 変数 `name` は初期値 'Taro' から string 型だと推論される
let name = 'Taro';

// name = 123; // エラー: Type 'number' is not assignable to type 'string'.

// 変数 `age` は初期値 30 から number 型だと推論される
let age = 30;

// 変数 `isAdult` は初期値 true から boolean 型だと推論される
let isAdult = true;
```

この例では、`name` に文字列リテラル `'Taro'` を代入しているため、TypeScriptは「`name` は `string` 型の変数である」と推論します。そのため、後から数値を代入しようとすると、コンパイルエラーが発生します。これにより、開発者は型を明記することなく、型の安全性を享受できます。

### 🔑 型注釈 (Type Annotation)

型注釈は、開発者が変数や関数の型を明示的に指定する方法です。変数名や関数名の後にコロン (`:`) を付け、その後に型名を記述します。

```typescript
// 変数 `username` は string 型であることを明示的に注釈
let username: string;

username = 'Jiro'; // OK
// username = false; // エラー: Type 'boolean' is not assignable to type 'string'.

// 関数の引数と戻り値の型を注釈
function greet(name: string): string {
  return `Hello, ${name}`;
}
```

#### 型注釈が必要なケース

型推論は非常に強力ですが、型注釈が不可欠な場面も存在します。

1.  **変数を初期化せずに宣言する場合**
    ```typescript
    let user; // `any` 型と推論されてしまう
    user = 'Saburo';
    user = 123; // エラーにならない！

    let safeUser: string; // string 型と明示
    safeUser = 'Shiro';
    // safeUser = 456; // エラーになる！
    ```

2.  **関数の引数**
    関数の引数は、呼び出されるまで値が不明なため、TypeScriptは型を推論できません。そのため、必ず型注釈が必要です。
    ```typescript
    // a と b の型が不明なためエラーになる
    // function add(a, b) {
    //   return a + b;
    // }

    // 型を注釈することで、安全な関数になる
    function add(a: number, b: number): number {
      return a + b;
    }
    ```

3.  **より複雑な型を扱う場合**
    オブジェクトや配列など、複数の型が組み合わさる場合、意図した通りの型を明示するために型注釈が役立ちます。
    ```typescript
    let post: { title: string; likes: number };
    post = { title: 'My first post', likes: 10 };
    ```

### 型推論と型注釈の使い分け

TypeScript開発におけるベストプラクティスは、**「可能な限り型推論に任せ、必要な場合にのみ型注釈を使う」**というものです。

| 状況 | 推奨される方法 | 理由 |
|:---|:---|:---|
| 変数を宣言と同時に初期化する | **型推論** | コードが冗長にならず、簡潔に保てるため。 |
| 変数を初期化せずに宣言する | **型注釈** | `any`型になるのを防ぎ、型の安全性を確保するため。 |
| 関数の引数 | **型注釈** | TypeScriptが型を推論できないため、必須。 |
| 関数の戻り値 | **型注釈**（推奨） | 意図しない戻り値を返してしまうバグを防ぎ、関数の仕様を明確にするため。 |

**関数の戻り値の型注釈は省略可能か？**

```typescript
// 戻り値の型は `number` と推論される
function multiply(a: number, b: number) {
  return a * b;
}
```

上記のように、TypeScriptは関数の `return` 文から戻り値の型を推論できます。しかし、複雑な関数では、意図せず異なる型を返してしまう可能性があります。そのため、**関数の戻り値には型注釈を付けることが一般的に推奨されます。**

## 💡 TIP

- VS Codeなどの高機能なエディタでは、型推論によって決定された変数の型を、マウスホバーで確認することができます。これにより、TypeScriptがどのように型を解釈しているかを簡単に知ることができます。

## ✨ まとめ

- **型推論**は、TypeScriptが初期値などから自動で型を決定する機能であり、コードを簡潔に保つ。
- **型注釈**は、`:` を使って開発者が明示的に型を指定する方法であり、関数の引数など推論が効かない場面で必須となる。
- 基本方針は「**型推論に任せ、必要な時だけ型注釈を使う**」。これにより、安全性と可読性のバランスの取れたコードを書くことができる。

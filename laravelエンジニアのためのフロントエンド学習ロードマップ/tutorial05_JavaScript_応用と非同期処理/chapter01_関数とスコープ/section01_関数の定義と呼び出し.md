# Tutorial 5: JavaScript応用と非同期処理

## Chapter 1: 関数とスコープ

### Section 1: 関数の定義と呼び出し (function, アロー関数)

🎯 **このセクションで学ぶこと**

-   `function`キーワードを使った、基本的な関数の定義方法と呼び出し方を習得する。
-   モダンなJavaScriptで主流となっている「アロー関数」の簡潔な構文を理解し、使えるようになる。
-   関数宣言と関数式の違い（巻き上げ）を理解する。

--- 

### イントロダクション：処理を「部品化」する

プログラミングをしていると、同じような処理の塊を何度も書く場面に遭遇します。例えば、「ユーザーの名前を受け取って、挨拶メッセージを生成する」といった処理です。このような処理をその都度書いていては、コードが冗長になり、修正があった場合にすべての箇所を直さなければならず、非常に非効率です。

**関数**は、このような「一連の処理の塊」に名前を付けて、再利用可能な「部品」にするための仕組みです。一度関数を定義しておけば、あとはその名前を呼び出すだけで、いつでも同じ処理を実行できます。

PHPでも関数は頻繁に使いますが、JavaScriptには伝統的な`function`キーワードを使った方法に加え、よりモダンで簡潔な**アロー関数**という書き方があり、現代のフロントエンド開発ではこちらが主流となっています。このセクションでは、両方の書き方をマスターしましょう。

--- 

### ⚙️ 1. `function`キーワードによる関数の定義（関数宣言）

最も基本的な関数の定義方法です。`function`キーワードに続けて関数名を記述します。

**基本構文:**
```javascript
function 関数名(引数1, 引数2, ...) {
  // 実行したい処理
  // return 戻り値;
}
```

**例：**
```javascript
// "sayHello"という名前の関数を定義
function sayHello() {
  console.log("こんにちは！");
}

// 関数を呼び出す
sayHello(); // "こんにちは！" と表示される
sayHello(); // 何度でも呼び出せる
```

### ⚙️ 2. アロー関数 (Arrow Functions)

アロー関数は、ES2015 (ES6) で導入された、より短く、より直感的に関数を記述するための構文です。`function`キーワードの代わりに、`=>`（アロー）を使います。現代のJavaScript、特にReactなどのフレームワークでは、こちらの書き方が広く使われています。

**基本構文:**
```javascript
const 関数名 = (引数1, 引数2, ...) => {
  // 実行したい処理
  // return 戻り値;
};
```

**例：**
```javascript
// "sayHello"という名前の関数をアロー関数で定義
const sayHello = () => {
  console.log("こんにちは！");
};

// 関数を呼び出す
sayHello(); // "こんにちは！" と表示される
```

#### アロー関数の省略記法

アロー関数には、特定の条件下でさらにコードを短く書ける省略記法があります。

1.  **引数が1つの場合、`()`を省略できる。**
    ```javascript
    // const greet = (name) => {
    const greet = name => {
      console.log(`こんにちは、${name}さん`);
    };
    greet("山田"); // "こんにちは、山田さん"
    ```

2.  **処理が1行だけで、その結果を`return`する場合、`{}`と`return`を省略できる。**
    ```javascript
    // const add = (a, b) => {
    //   return a + b;
    // };
    const add = (a, b) => a + b;

    const result = add(3, 5);
    console.log(result); // 8
    ```

この省略記法は、コールバック関数（後述）などで非常に多用されるため、ぜひ慣れておきましょう。

### 🤔 関数宣言 vs 関数式（アロー関数）

`function`キーワードで定義する方法を**関数宣言**、アロー関数（や無名関数）を定数や変数に代入する方法を**関数式**と呼びます。

この2つには、**巻き上げ（Hoisting）**という挙動に重要な違いがあります。

-   **関数宣言:** コードが実行される前に、JavaScriptエンジンによって関数の定義がファイルの先頭に「巻き上げ」られます。そのため、**定義より前の行で関数を呼び出すことが可能**です。

    ```javascript
    sayHi(); // "やあ！" -> エラーにならない

    function sayHi() {
      console.log("やあ！");
    }
    ```

-   **関数式（アロー関数など）:** 変数（`const`や`let`）のルールに従います。`const`や`let`は巻き上げられますが、初期化（関数の代入）はコードのその行に来るまで行われません。そのため、**定義より前の行で呼び出すとエラーになります**。

    ```javascript
    sayHi(); // ReferenceError: Cannot access 'sayHi' before initialization

    const sayHi = () => {
      console.log("やあ！");
    };
    ```

**ベストプラクティス:**
巻き上げによる挙動の違いは、時に混乱を招きます。関数は、**呼び出す前に定義する**という一貫したスタイルを保つことが、バグの少ないコードを書くための良い習慣です。そのため、現代の開発では、巻き上げが起こらず、より厳格な`const`を使った**アロー関数（関数式）**の方が好まれる傾向にあります。

--- 

✨ **まとめ**

-   関数は、処理を「部品化」して再利用するための仕組みである。
-   伝統的な`function`キーワードによる「関数宣言」と、モダンな`=>`を使った「アロー関数（関数式）」の2つの書き方がある。
-   アロー関数には、コードを簡潔にするための省略記法がある。
-   関数宣言は「巻き上げ」により定義前に呼び出せるが、関数式は定義前に呼び出すとエラーになる。この挙動を理解し、一貫したスタイルで記述することが重要である。

📝 **学習のポイント**

-   [ ] 2つの数値を受け取り、その積を返す`multiply`という名前の関数を、①関数宣言 と ②アロー関数 の両方の方法で定義してみてください。
-   [ ] アロー関数の省略記法が使えるのは、どのような場合ですか？2つの条件を説明してください。
-   [ ] 「巻き上げ」とは何か、関数宣言と関数式の違いを含めて説明できますか？なぜ現代の開発ではアロー関数が好まれる傾向にあるのでしょうか？

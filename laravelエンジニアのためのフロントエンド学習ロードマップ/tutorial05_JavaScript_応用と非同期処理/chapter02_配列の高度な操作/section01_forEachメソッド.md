# Tutorial 5: JavaScript応用と非同期処理

## Chapter 2: 配列の高度な操作

### Section 1: forEachメソッド

🎯 **このセクションで学ぶこと**

-   `forEach`メソッドを使い、配列の各要素に対して繰り返し処理を実行できるようになる。
-   **コールバック関数**の基本的な概念を理解する。
-   `for...of`ループと`forEach`メソッドの違いと、それぞれの使い分けを理解する。

--- 

### イントロダクション：配列操作の新しいスタイル

Chapter 1では、`for...of`ループを使って配列の要素を一つずつ取り出して処理する方法を学びました。これは非常に便利で直感的な方法ですが、JavaScriptには、より「関数型プログラミング」のスタイルに近い、配列を操作するための強力なメソッド群が用意されています。

その入り口となるのが`forEach`メソッドです。`forEach`は、配列の各要素に対して、私たちが用意した「関数」を一度ずつ実行します。この「後で呼び出される関数」のことを**コールバック関数**と呼び、現代のJavaScriptを理解する上で避けては通れない、非常に重要な概念です。

Laravelのコレクションメソッド（`each`など）に慣れている方なら、この考え方にはすぐに馴染めるでしょう。ループ構文で「外側から」配列を操作するのではなく、配列自身が持つメソッドに「内側から」処理を任せるスタイルに、ぜひ慣れていきましょう。

--- 

### ⚙️ `forEach`メソッドの基本構文

`forEach`は、配列が持つメソッドの一つです。引数として、各要素に対して実行したい処理を記述した**コールバック関数**を受け取ります。

**基本構文:**
```javascript
配列.forEach(コールバック関数);
```

コールバック関数は、`forEach`によって配列の要素の数だけ呼び出され、呼び出されるたびに以下の3つの引数を受け取ることができます。

```javascript
(要素, インデックス, 元の配列) => {
  // 処理
}
```

-   **要素 (element):** 現在処理中の配列の要素。**（必須）**
-   **インデックス (index):** 現在処理中の要素のインデックス番号。（オプション）
-   **元の配列 (array):** `forEach`を呼び出した配列そのもの。（オプション）

通常、第一引数の「要素」だけを使うことがほとんどです。

**例：**
```javascript
const fruits = ["りんご", "バナナ", "みかん"];

// アロー関数をコールバックとして渡す
fruits.forEach((fruit, index) => {
  console.log(`${index + 1}番目の果物は${fruit}です`);
});

// 出力:
// "1番目の果物はりんごです"
// "2番目の果物はバナナです"
// "3番目の果物はみかんです"
```

--- 

### 🤔 `for...of` vs `forEach`：どっちを使う？

`for...of`ループと`forEach`メソッドは、どちらも配列の繰り返し処理に使えますが、いくつかの重要な違いがあります。

| 特徴 | `for...of` ループ | `forEach` メソッド |
|:---|:---|:---|
| **構文** | `for (const el of arr)` | `arr.forEach(el => { ... })` |
| **中断** | `break`で中断できる | 中断できない（全要素を処理） |
| **非同期処理** | `async/await`を自然に使える | `async/await`を直接使えない ⚠️ |
| **戻り値** | なし | `undefined`（常に） |

**使い分けのガイドライン:**

1.  **ループを途中で中断したい場合は `for...of` を使う**
    -   `forEach`は、一度始めたら配列の最後まで処理を止められません。特定の条件でループを抜けたい場合は、`break`が使える`for...of`が必須です。

    ```javascript
    const numbers = [1, 2, 3, 4, 5];
    let sum = 0;
    for (const num of numbers) {
      if (sum + num > 10) {
        break; // 合計が10を超えたら中断
      }
      sum += num;
    }
    // sum は 10 (1+2+3+4)
    ```

2.  **シンプルに全要素を処理するだけなら `forEach` が簡潔**
    -   中断する必要がなく、各要素に対して同じ処理を行うだけなら、`forEach`の方がメソッドチェーン（後述）との相性も良く、コードがスッキリします。

3.  **非同期処理（`async/await`）をループ内で行う場合は `for...of` を使う**
    -   これは応用的なトピックですが、`forEach`のコールバックに`async`キーワードを付けても、`forEach`自体は`await`（待機）してくれません。ループ内で非同期処理を順番に待ちたい場合は、`for...of`を使う必要があります。（詳細は後のChapterで学びます）

**結論：** どちらを使うかは好みの問題も大きいですが、**「中断する可能性があるか？」**を一つの判断基準にするのが良いでしょう。そうでなければ、より関数的なスタイルである`forEach`に慣れておくことをお勧めします。

--- 

✨ **まとめ**

-   `forEach`は、配列の各要素に対して、引数で渡された**コールバック関数**を一度ずつ実行するメソッドである。
-   コールバック関数は、引数として「要素」「インデックス」「元の配列」を受け取ることができる。
-   `for...of`は`break`でループを中断できるが、`forEach`は中断できない。
-   ループ内で非同期処理を待機したい場合は、`for...of`を使う必要がある。
-   単純な繰り返し処理では、`forEach`はコードを簡潔にし、関数型プログラミングのスタイルと親和性が高い。

📝 **学習のポイント**

-   [ ] `const scores = [80, 95, 72, 100];` という配列があります。`forEach`を使って、各点数をコンソールに`"点数: 80点"`のように表示するコードを書いてください。
-   [ ] コールバック関数とは何か、自分の言葉で説明できますか？
-   [ ] `for...of`と`forEach`の最も決定的な違いは何ですか？どのような場合に`for...of`を選ぶべきか、具体的な例を挙げて説明してください。

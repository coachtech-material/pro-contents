# Tutorial 5: JavaScript応用と非同期処理

## Chapter 2: 配列の高度な操作

### Section 2: mapメソッド

🎯 **このセクションで学ぶこと**

-   `map`メソッドを使い、元の配列の各要素を変換して、**新しい配列**を作成できるようになる。
-   `forEach`と`map`の決定的な違い（戻り値の有無）を理解する。
-   Reactなどのフレームワークで、なぜ`map`が頻繁に使われるのかを理解する。

--- 

### イントロダクション：配列を「写像」する

`forEach`は、配列の各要素に対して処理を実行するだけでした。しかし、実務では「元の配列の各要素を加工して、新しい配列が欲しい」という場面が非常に多くあります。例えば、

-   数値の配列を、すべて2倍にした新しい配列が欲しい。
-   ユーザーオブジェクトの配列から、名前だけを取り出した文字列の配列が欲しい。
-   投稿データの配列を、HTMLのリストタグ（`<li>`）の配列に変換したい。

このような「配列から配列への変換（写像）」を行うための専用メソッドが`map`です。`map`は、現代のJavaScriptにおける配列操作の**主役**とも言える、極めて重要で強力なメソッドです。Laravelコレクションの`map`メソッドと全く同じ働きをします。

--- 

### ⚙️ `map`メソッドの基本構文

`map`も`forEach`と同様に、コールバック関数を引数に取ります。しかし、決定的な違いは、`map`が**新しい配列を戻り値として返す**点です。

コールバック関数は、各要素に対して呼び出され、その**戻り値**が、新しい配列の要素になります。

**基本構文:**
```javascript
const newArray = oldArray.map(コールバック関数);
```

コールバック関数が受け取る引数は`forEach`と同じです。

```javascript
(要素, インデックス, 元の配列) => {
  // 新しい配列の要素となる値を return する
  return 変換後の値;
}
```

**例1：数値の配列を2倍にする**
```javascript
const numbers = [1, 2, 3, 4, 5];

const doubledNumbers = numbers.map((num) => {
  return num * 2;
});

console.log(doubledNumbers); // [2, 4, 6, 8, 10]
console.log(numbers);        // [1, 2, 3, 4, 5] (元の配列は変更されない)
```

-   **重要なポイント:** `map`は、元の配列を一切変更しません（**非破壊的メソッド**）。代わりに、変換後の要素を持つ新しい配列を返します。

**例2：ユーザーオブジェクトの配列から名前の配列を作成する**
```javascript
const users = [
  { id: 1, name: "山田" },
  { id: 2, name: "鈴木" },
  { id: 3, name: "田中" },
];

// アロー関数の省略記法を使うと、さらに簡潔に書ける
const userNames = users.map(user => user.name);

console.log(userNames); // ["山田", "鈴木", "田中"]
```

--- 

### 🤔 `forEach` vs `map`：決定的な違い

`forEach`と`map`は似ていますが、その目的は全く異なります。

-   **`forEach`**: **何も返さない**。各要素に対して「何か処理をしたい」だけの場合に使う。（例: 各要素をコンソールに表示する）
-   **`map`**: **新しい配列を返す**。元の配列を元に「新しい配列を作りたい」場合に使う。（例: 各要素を2倍にした新しい配列を作る）

`map`を使って`forEach`と同じようなことを書くのはアンチパターンです。

```javascript
// 良くない例：mapの戻り値を使っていない
const numbers = [1, 2, 3];
numbers.map(num => {
  console.log(num); // これはforEachの仕事
});
```

**使い分けのイメージ:**

-   「この配列のやつ、**全部**やっといて」 → `forEach`
-   「この配列のやつ、**全部**これに**変えといて**」 → `map`

### 🚀 `map`とReact

`map`が特に輝くのが、ReactのようなUIフレームワークでの使用です。Reactでは、「データの配列」から「コンポーネントの配列」を生成するという操作が日常的に行われます。`map`は、この変換にまさにうってつけです。

```jsx
// (これはReactのコードです。今は雰囲気を掴むだけでOK)

const userNames = ["山田", "鈴木", "田中"];

// userNames配列 (文字列の配列) を
// <li>要素の配列に変換している
const userListItems = userNames.map(name => <li key={name}>{name}</li>);

// userListItems は [<li key="山田">山田</li>, <li key="鈴木">鈴木</li>, ... ] という
// React要素の配列になる

// これを画面に表示する
return (
  <ul>
    {userListItems}
  </ul>
);
```

このように、`map`はデータとUIを結びつけるための非常に重要な橋渡し役となります。このパターンは後のReactの章で何度も登場しますので、今のうちに`map`の「配列を変換して新しい配列を作る」という役割をしっかり理解しておきましょう。

--- 

✨ **まとめ**

-   `map`は、配列の各要素に対してコールバック関数を実行し、その**戻り値からなる新しい配列を返す**メソッドである。
-   `map`は元の配列を変更しない（非破壊的）。
-   `forEach`が「処理の実行」を目的とするのに対し、`map`は「**新しい配列の生成**」を目的とする。
-   `map`は、データの配列をUI要素の配列に変換する、といった場面で非常に強力であり、React開発の必須スキルである。

📝 **学習のポイント**

-   [ ] `const prices = [100, 250, 500];` という税抜価格の配列があります。`map`を使って、各価格を1.1倍（消費税10%）した税込価格の新しい配列`taxIncludedPrices`を作成してください。
-   [ ] `forEach`と`map`の最も重要な違いは何ですか？それぞれのメソッドが返す値（戻り値）に着目して説明してください。
-   [ ] `const files = ["image.jpg", "document.pdf", "archive.zip"];` という配列があります。`map`を使って、各ファイル名から拡張子（`.`以降）を取り除いた、`["image", "document", "archive"]`という新しい配列を作成するにはどうすればよいか、考えてみましょう。（ヒント: 文字列の`split`メソッドが使えます）

# 10-2-3: 取得したデータを表示する

## 🎯 このセクションで学ぶこと

-   Laravel側でCORS設定を行い、クロスオリジンリクエストを許可する方法を学ぶ
-   APIから取得したデータの配列を、Reactコンポーネントで`map`メソッドを使ってリスト表示する方法を習得する
-   Tailwind CSSを使って、取得したデータをカード形式のUIで整形する方法を学ぶ

## 導入

前のセクションで、Next.jsからLaravel APIを呼び出した際にCORSエラーが発生しました。このエラーは、サーバー（Laravel）がクライアント（Next.js）からのリクエストを許可していないために起こります。

このセクションでは、まずLaravel側でCORSの設定を行い、この問題を解決します。その後、無事に取得できた商品データを、JSONの文字列ではなく、見やすいカード形式のUIで画面に表示します。

## 詳細解説

### ステップ1: LaravelでのCORS設定

Laravelには、CORS関連の設定を簡単に行うための仕組みが標準で用意されています。

1.  **`config/cors.php`の確認**
    Laravelプロジェクトの`config/cors.php`ファイルを開いてください。このファイルで、CORSに関する詳細な設定ができます。

2.  **`.env`ファイルの設定**
    `config/cors.php`を見ると、許可するオリジン（`allowed_origins`）の設定が、環境変数`CORS_ALLOWED_ORIGINS`から読み込まれるようになっていることがわかります。

    ```php
    // config/cors.php
    
    // ...
    'allowed_origins' => explode(
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        
        	
        
        
        
        
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        			
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        	
        -   `allowed_origins` => env(
        -       'CORS_ALLOWED_ORIGINS',
        -       'http://localhost:3000,http://127.0.0.1:3000'
        -   ),
        +   `allowed_origins` => [
        +       env(
        +           'FRONTEND_URL',
        +           'http://localhost:3000'
        +       )
        +   ],
    // ...
    ```

    Laravelプロジェクトのルートにある`.env`ファイルに、Next.jsアプリケーションのURLを追記します。

    ```.env
    # .env (Laravelプロジェクトのルート)

    # ... 他の設定

    CORS_ALLOWED_ORIGINS=http://localhost:3000
    ```

    この設定により、Laravelは`http://localhost:3000`からのAPIリクエストを許可するようになります。

    **注意**: `.env`ファイルを変更した後は、設定を反映させるためにSailを再起動する必要があります。

    ```bash
    # Laravelプロジェクトのディレクトリで実行
    sail down
    sail up -d
    ```

3.  **動作確認**
    Sailを再起動したら、再度ブラウザで`http://localhost:3000/products`にアクセスしてください。今度はCORSエラーが消え、前のセクションで`pre`タグで表示したJSONデータが画面に表示されるはずです。

### ステップ2: 取得したデータをUIに反映する

APIからデータを無事に取得できるようになったので、次はこのデータをユーザーに見やすいように表示します。

`src/app/products/page.tsx`（Next.jsプロジェクト）を以下のように編集してください。

```tsx
// src/app/products/page.tsx

// Productインターフェースは変更なし
interface Product {
  id: number;
  name: string;
  description: string;
  price: number;
  created_at: string;
  updated_at: string;
}

async function getProducts(): Promise<Product[]> {
  // getProducts関数は変更なし
  const url = `${process.env.NEXT_PUBLIC_API_BASE_URL}/products`;
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) {
    throw new Error("Failed to fetch products");
  }
  return res.json();
}

// 商品カードコンポーネント
function ProductCard({ product }: { product: Product }) {
  return (
    <div className="border rounded-lg p-6 shadow-md bg-white">
      <h2 className="text-2xl font-semibold mb-2">{product.name}</h2>
      <p className="text-gray-600 mb-4">{product.description}</p>
      <p className="text-xl font-bold text-right text-gray-800">
        &yen;{product.price.toLocaleString()}
      </p>
    </div>
  );
}

// 商品一覧ページのコンポーネント
export default async function ProductsPage() {
  const products = await getProducts();

  return (
    <main className="container mx-auto p-8 bg-gray-50 min-h-screen">
      <h1 className="text-4xl font-bold mb-10 text-center text-gray-800">
        商品一覧
      </h1>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {products.map((product) => (
          <ProductCard key={product.id} product={product} />
        ))}
      </div>
    </main>
  );
}
```

**コードのポイント:**

-   **`ProductCard`コンポーネント**: 一つの商品情報を表示するための、再利用可能なコンポーネントを新たに作成しました。`product`オブジェクトを`props`として受け取ります。
-   **`map`メソッドによる繰り返し**: `products`配列（APIから取得した商品データの配列）に対して`map`メソッドを使い、配列の各要素（各`product`オブジェクト）に対して`ProductCard`コンポーネントを生成しています。これはReactでリスト表示を行う際の基本的なパターンです。
-   **`key`プロパティ**: `map`でリストを生成する際には、各要素に一意の`key`プロパティを指定する必要があります。Reactは、この`key`を使ってどの要素が変更、追加、削除されたのかを効率的に判断します。通常は、データに存在するユニークなID（今回は`product.id`）を使用します。
-   **Tailwind CSSによるスタイリング**: `grid`, `gap`, `p-6`, `shadow-md`など、Tailwind CSSのユーティリティクラスを使って、レスポンシブ対応のカード型レイアウトを簡単に実現しています。

ファイルを保存して`http://localhost:3000/products`を再度見てみましょう。以下のように、商品データがカード形式で綺麗に表示されているはずです。

![商品一覧ページ](https://raw.githubusercontent.com/coachtech-material/pro-contents/main/laravel%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E5%AD%A6%E7%BF%92%E3%83%AD%E3%83%BC%E3%83%89%E3%83%9E%E3%83%83%E3%83%97/images/tutorial-10/product-list.png)

## ✨ まとめ

-   LaravelのCORS設定は、`config/cors.php`と`.env`ファイルを編集することで、特定のオリジンからのリクエストを許可できる。
-   Reactでは、データの配列を`map`メソッドで展開し、各要素に対応するコンポーネントを生成するのがリスト表示の基本パターンである。
-   `map`を使う際には、各要素にユニークな`key`プロパティを必ず指定する。
-   Tailwind CSSを使えば、コンポーネントに直接クラスを記述するだけで、迅速にUIを構築できる。

これで、LaravelバックエンドとNext.jsフロントエンドが連携する、ヘッドレスアプリケーションの基本的な形が完成しました。次のチャプターでは、このアプリケーションに認証機能を追加していきます。

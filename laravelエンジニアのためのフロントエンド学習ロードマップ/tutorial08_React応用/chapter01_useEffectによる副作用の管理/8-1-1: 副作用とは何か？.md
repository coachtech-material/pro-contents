# 8-1-1: 副作用とは何か？

## Chapter 1: `useEffect`による副作用の管理

### Section 1: 副作用とは何か？

🎯 **このセクションで学ぶこと**

-   Reactにおける「**副作用 (Side Effect)**」の概念を理解する。
-   なぜ副作用をReactコンポーネントのレンダリングロジックから分離する必要があるのかを説明できるようになる。
-   副作用の具体的な例（API通信、DOM操作、タイマー設定など）を挙げられるようになる。

--- 

### イントロダクション：Reactの世界と「外の世界」

これまで学んできたReactコンポーネントの主な役割は、PropsとStateを受け取り、それに基づいてUI（JSX）を返すことでした。これは、同じ入力（Props, State）に対して常に同じ出力（UI）を返す、数学の**純粋関数**のような振る舞いです。

```
(Props, State) => UI
```

この「純粋さ」が、Reactの予測可能性とテストのしやすさを支えています。しかし、実際のアプリケーションは、UIを画面に表示するだけで完結するわけではありません。多くの場合、Reactコンポーネントは「**外の世界**」とやり取りをする必要があります。

-   サーバーからデータを取得する（**API通信**）
-   ブラウザの`document`や`window`を直接操作する（**DOM操作**）
-   `setTimeout`や`setInterval`でタイマーを設定する
-   ブラウザの`localStorage`にデータを保存する

このように、**コンポーネントのレンダリングという主な処理とは直接関係のない、外部システムとのやり取り**のことを、Reactでは**副作用 (Side Effect)** と呼びます。

--- 

### ⚙️ なぜ副作用を分離するのか？

副作用をコンポーネントのトップレベル（レンダリングロジックの中）で直接実行すると、様々な問題が発生します。

**❌ やってはいけないこと：レンダリング中に副作用を実行する**

```tsx
function MyComponent() {
  // 悪い例：レンダリングのたびにAPIを叩いてしまう！
  fetch("https://api.example.com/data")
    .then(res => res.json())
    .then(data => console.log(data));

  return <div>Hello World</div>;
}
```

このコードの問題点は何でしょうか？

Reactコンポーネントは、初回レンダリング時だけでなく、親コンポーネントが再レンダリングされたり、自身のStateが更新されたりするたびに、**何度も再レンダリング**されます。そのたびにAPIリクエストが送られてしまい、サーバーに過剰な負荷をかけ、意図しない挙動を引き起こします。

レンダリングは、あくまで「UIを計算する」ための純粋な時間であるべきです。副作用は、その計算結果が画面に反映された**後**など、特定のタイミングで実行されるように、レンダリングのプロセスから明確に分離する必要があります。

この「**特定のタイミングで副作用を実行する**」ために使われるフックが、`useEffect`です。

--- 

### 🚀 副作用の具体例

`useEffect`を学ぶ前に、どのような処理が副作用にあたるのか、具体例を見てみましょう。

| 副作用の種類 | 具体例 | なぜ副作用なのか？ |
|:---|:---|:---|
| **API通信** | `fetch`や`axios`を使ってサーバーからデータを取得・送信する | Reactコンポーネントの外部にあるサーバーと通信しているから |
| **DOM操作** | `document.getElementById`や`window.addEventListener`を使う | Reactが管理する仮想DOMではなく、ブラウザが持つ実際のDOMやグローバルオブジェクトを直接操作しているから |
| **タイマー** | `setTimeout`や`setInterval`で遅延処理や定期処理を設定する | ブラウザのタイマー機能という外部システムに処理を予約しているから |
| **ローカルストレージ** | `localStorage.setItem`や`localStorage.getItem`でデータを読み書きする | ブラウザのストレージ機能という外部システムとやり取りしているから |
| **ロギング** | 外部のログサービスに情報を送信する | 外部のログ収集サーバーと通信しているから |

これらの処理に共通するのは、「**Reactの管理外にある、外部の状態を読み取ったり、書き換えたりする**」という点です。このような処理はすべて、`useEffect`の中で管理するのがReactの基本ルールです。

--- 

✨ **まとめ**

-   **副作用 (Side Effect)** とは、コンポーネントのレンダリングとは直接関係のない、外部システムとのやり取りのこと。
-   副作用は、レンダリングのたびに実行されるべきではないため、コンポーネントのレンダリングロジックから分離する必要がある。
-   副作用の具体例には、API通信、DOM操作、タイマー設定、ローカルストレージへのアクセスなどがある。
-   これらの副作用を管理するために、Reactでは`useEffect`フックが提供されている。

📝 **学習のポイント**

-   [ ] あなたが普段使っているWebアプリケーションで、副作用だと思われる処理を3つ探してみてください。（例: Twitterのタイムライン読み込み、YouTubeの動画再生、Google Docsの自動保存）
-   [ ] なぜコンポーネントのレンダリングは「純粋」であるべきなのでしょうか？ 純粋であることのメリットを考えてみましょう。
-   [ ] `console.log()`は副作用でしょうか？ 考えてみましょう。（ヒント: どこに情報を書き出していますか？）

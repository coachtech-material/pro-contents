# 7-2-3: フォーム入力の処理（Controlled Components）

## 🎯 このセクションで学ぶこと

- Reactにおけるフォームの基本的な扱い方を理解する
- **Controlled Components（制御されたコンポーネント）**という重要な概念を習得する
- `useState` を使ってフォームの入力値を管理し、ユーザーの入力にリアルタイムで反応する方法を学ぶ

## 導入

Webアプリケーションにおいて、ユーザーからの入力を受け取るフォームは不可欠な要素です。しかし、Reactにおけるフォームの扱いは、従来のDOMを直接操作するアプローチ（例: jQueryで `$("#my-input").val()` を取得する）とは根本的に異なります。

Reactでは、**「状態（State）がUIを駆動する」**という原則に基づき、フォームの入力値もコンポーネントの状態として管理します。このアプローチは**Controlled Components（制御されたコンポーネント）**と呼ばれ、Reactにおけるフォーム処理の標準的な方法です。UIの状態をReactコンポーネントが一元管理することで、データの流れが予測可能になり、アプリケーション全体の見通しが良くなります。

## 詳細解説

### 🔑 Controlled Componentsとは？

Controlled Componentsとは、フォームの入力要素（`<input>`, `<textarea>`, `<select>`など）の値を、Reactの**State**によって「制御」する設計パターンのことです。具体的には、以下の2つのことを行います。

1.  入力要素の`value`属性に、ReactのStateをバインドする。
2.  入力要素の`onChange`イベントを捕捉し、ユーザーが入力するたびにStateを更新する。

これにより、**常にReactのStateが唯一の信頼できる情報源（Single Source of Truth）**となり、UIの表示とデータが完全に同期します。ユーザーがキーをタイプするたびに、以下のサイクルが回ります。

1.  `onChange`イベントが発生する。
2.  イベントハンドラが実行され、`set`関数でStateを更新する。
3.  Stateが更新されたことで、コンポーネントが再レンダリングされる。
4.  入力要素の`value`が、更新された新しいStateの値で表示される。

### 実装例: シンプルなテキスト入力

実際にコードを見てみましょう。ユーザーが名前を入力するためのシンプルなフォームです。

```jsx
import React, { useState } from 'react';

function NameForm() {
  // 1. 入力値を保持するためのStateを定義
  const [name, setName] = useState('');

  // 2. onChangeイベントハンドラを定義
  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    // event.target.value に現在の入力値が入っている
    setName(event.target.value);
  };

  // 3. フォーム送信時の処理を定義
  const handleSubmit = (event: React.FormEvent<HTMLFormElement>) => {
    // フォーム送信によるページの再読み込みを防止
    event.preventDefault();
    alert(`A name was submitted: ${name}`);
  };

  return (
    <form onSubmit={handleSubmit}>
      <label>
        Name:
        {/* 4. Stateを入力要素のvalueにバインドし、onChangeハンドラを設定 */}
        <input type="text" value={name} onChange={handleChange} />
      </label>
      <button type="submit">Submit</button>
      
      {/* 入力がリアルタイムでStateに反映されていることを確認 */}
      <p>Current input: {name}</p>
    </form>
  );
}

export default NameForm;
```

#### コードのポイント

- **`useState('')`**: `name`というState変数を初期値空文字列で作成します。この`name`がフォーム入力の唯一のデータソースとなります。
- **`handleChange`**: `input`要素で何か変更があるたびに呼び出されます。`event.target.value`で現在の入力値を取得し、`setName`で`name`のStateを更新します。
- **`value={name}`**: `input`要素の表示内容を、常に`name` Stateの値に一致させます。これによりReactが`input`を「制御」します。
- **`onSubmit`と`event.preventDefault()`**: `<form>`が送信されたときに`handleSubmit`が呼ばれます。`event.preventDefault()`は、ブラウザがデフォルトで行うページ遷移（再読み込み）をキャンセルするために必須です。

## 💡 TIP: 複数の入力の扱い

フォームに複数の入力項目がある場合、項目ごとに`useState`を用意することもできますが、Stateをオブジェクトとして一つにまとめる方法も一般的です。その際、`name`属性を使ってどの入力が変更されたかを識別すると便利です。

```jsx
const [formValues, setFormValues] = useState({ username: '', password: '' });

const handleInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {
  const { name, value } = event.target;
  setFormValues({ ...formValues, [name]: value });
};

// <input type="text" name="username" value={formValues.username} onChange={handleInputChange} />
// <input type="password" name="password" value={formValues.password} onChange={handleInputChange} />
```

## ✨ まとめ

- Reactでは、フォームの入力値をコンポーネントの**State**で管理する**Controlled Components**が基本である。
- `input`要素の`value`をStateに結びつけ、`onChange`イベントでStateを更新することで、UIとデータを常に同期させる。
- このパターンにより、入力値のバリデーションや、入力に応じたUIの動的な変更などが容易になる。
- フォームの送信は`<form>`の`onSubmit`イベントでハンドリングし、`event.preventDefault()`でページの再読み込みを防ぐ。

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パフォーマンス最適化 | pro-contents</title>
    <meta name="description" content="Pro生用プログラミング教材コンテンツ">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div id="outer">
        <header>
            <h1><a href="index.html">pro-contents</a></h1>
            <p class="description">Pro生用プログラミング教材コンテンツ</p>
        </header>
        <div id="container">
            <aside>
                <div id="side-inner">
                    <div class="side-title">チュートリアル一覧</div>
<div class="side"><ul>
<li><a href="tutorial01_開発環境とWebの基礎固め.html">Tutorial 1: 開発環境とWebの基礎固め</a></li>
<li><a href="tutorial02_HTML_CSS基礎.html">Tutorial 2: HTML/CSS基礎</a></li>
<li><a href="tutorial03_Tailwind_CSS徹底習得.html">Tutorial 3: Tailwind CSS徹底習得</a></li>
<li><a href="tutorial04_JavaScript_基礎とDOM操作.html">Tutorial 4: JavaScript基礎とDOM操作</a></li>
<li><a href="tutorial05_JavaScript_応用と非同期処理.html">Tutorial 5: JavaScript応用と非同期処理</a></li>
<li><a href="tutorial06_TypeScript入門.html">Tutorial 6: TypeScript入門</a></li>
<li><a href="tutorial07_React入門.html">Tutorial 7: React入門</a></li>
<li><a href="tutorial08_React応用.html">Tutorial 8: React応用</a></li>
<li><a href="tutorial09_Next.js.html" class="current">Tutorial 9: Next.js</a></li>
<li><a href="tutorial10_Laravel_x_Next.js.html">Tutorial 10: Laravel × Next.js</a></li>
<li><a href="tutorial11_テスト.html">Tutorial 11: テスト</a></li>
<li><a href="tutorial12_column.html">上級コラム: Webレンダリングの深層理解</a></li>
</ul></div>

                </div>
            </aside>
            <div id="content">
                <div class="inner">
                    <div class="breadcrumb"><a href="../index.html">ホーム</a><span>></span><a href="index.html">Laravelエンジニアのためのフロントエンド学習ロードマップ</a><span>></span><a href="tutorial09_Next.js.html">Tutorial 9: Next.js</a><span>></span><a href="tutorial09_Next.js_chapter03_レンダリングとパフォーマンス.html">Chapter 3: レンダリングとパフォーマンス</a><span>></span>パフォーマンス最適化</div>
                    <div class="section-content">
<h1 id="9-3-3">9-3-3: パフォーマンス最適化</h1>
<h2 id="_1">🎯 このセクションで学ぶこと</h2>
<ul>
<li>Webパフォーマンスの重要性と主要な指標（Core Web Vitals）を理解する</li>
<li>Next.jsが提供する組み込みのパフォーマンス最適化機能を学ぶ</li>
<li><code>next/image</code>コンポーネントを使った画像の自動最適化の方法を習得する</li>
<li><code>next/font</code>を使ったWebフォントの最適化とレイアウトシフト防止の方法を習得する</li>
<li>Dynamic Imports (<code>next/dynamic</code>) を使ったコンポーネントの遅延読み込みとコード分割の方法を学ぶ</li>
</ul>
<h2 id="_2">導入</h2>
<p>Next.jsは、デフォルトで高いパフォーマンスを発揮するように設計されていますが、アプリケーションが成長するにつれて、パフォーマンスのボトルネックが発生することがあります。特に、画像、フォント、サードパーティのJavaScriptは、ページの読み込み速度に大きな影響を与える三大要因です。</p>
<p>幸いなことに、Next.jsはこれらの一般的なパフォーマンス問題を解決するための、強力で使いやすい組み込みコンポーネントと機能を提供しています。このセクションでは、Next.jsアプリケーションのパフォーマンスをさらに向上させるための、以下の3つの重要なテクニックに焦点を当てます。</p>
<ol>
<li><strong>画像最適化 (<code>next/image</code>)</strong>: 画像のサイズを自動的に最適化し、最新の画像フォーマットで配信する。</li>
<li><strong>フォント最適化 (<code>next/font</code>)</strong>: Webフォントの読み込みを効率化し、レイアウトシフトを防ぐ。</li>
<li><strong>動的インポート (<code>next/dynamic</code>)</strong>: 初期表示に不要なコンポーネントを遅延読み込みし、JavaScriptのバンドルサイズを削減する。</li>
</ol>
<p>これらの機能を活用することで、Core Web Vitals（Googleが提唱するWeb体験の品質指標）を改善し、ユーザー体験とSEOの両方を向上させることができます。</p>
<h2 id="_3">詳細解説</h2>
<h3 id="1-image">1. 画像最適化: <code>&lt;Image&gt;</code> コンポーネント</h3>
<p>Webサイトで最も重いアセットは画像であることが多いです。巨大な画像をそのまま配信すると、ページの読み込みが著しく遅くなります。Next.jsの<code>&lt;Image&gt;</code>コンポーネント（<code>next/image</code>からインポート）は、この問題を解決するためのオールインワンソリューションです。</p>
<p>標準の<code>&lt;img&gt;</code>タグの代わりに<code>&lt;Image&gt;</code>コンポーネントを使うだけで、Next.jsは自動的に以下の最適化を行います。</p>
<ul>
<li><strong>サイズ最適化</strong>: デバイスのビューポートに合わせて、適切なサイズの画像を自動的に生成・配信します。巨大な画像をモバイルデバイスに送るような無駄がなくなります。</li>
<li><strong>フォーマット最適化</strong>: ブラウザが対応していれば、WebPやAVIFのような次世代の軽量な画像フォーマットに自動的に変換して配信します。</li>
<li><strong>遅延読み込み (Lazy Loading)</strong>: デフォルトで、ビューポートに入るまで画像の読み込みを遅延させます。初期表示に関係ない画像の読み込みを後回しにすることで、ページの初期表示速度を向上させます。</li>
<li><strong>レイアウトシフトの防止</strong>: 画像の<code>width</code>と<code>height</code>を必須とすることで、画像の読み込み中に発生するガタつき（Cumulative Layout Shift, CLS）を自動的に防ぎます。</li>
</ul>
<p><strong>使い方:</strong></p>
<pre class="codehilite"><code class="language-tsx">import Image from &quot;next/image&quot;;
import profilePic from &quot;../public/me.png&quot;; // ローカル画像はimportする

export default function MyPage() {
  return (
    &lt;div&gt;
      {/* ローカル画像の場合 */}
      &lt;Image
        src={profilePic} // importしたオブジェクトを渡す
        alt=&quot;Picture of the author&quot;
        // widthとheightは必須 (インポートした静的画像の場合は自動で設定される)
        // placeholder=&quot;blur&quot; // オプション: ブラーアップ効果
      /&gt;

      {/* 外部画像の場合 */}
      &lt;Image
        src=&quot;https://images.unsplash.com/photo-15...&quot;
        alt=&quot;A beautiful landscape&quot;
        width={500} // 必須
        height={300} // 必須
      /&gt;
    &lt;/div&gt;
  );
}
</code></pre>

<p><code>&lt;img&gt;</code>を<code>&lt;Image&gt;</code>に置き換えるだけで、これだけの最適化が自動的に行われるのは非常に強力です。</p>
<h3 id="2-nextfont">2. フォント最適化: <code>next/font</code></h3>
<p>Webフォント（特にGoogle Fonts）は手軽に使えますが、外部からフォントファイルをダウンロードするため、レンダリングをブロックしたり、フォントの読み込み前後でテキストのスタイルが一瞬変わる（FOUT）/非表示になる（FOIT）、レイアウトがずれる（CLS）といった問題を引き起こす可能性があります。</p>
<p><code>next/font</code>は、この問題を解決します。フォントファイルをビルド時にダウンロードし、他の静的アセットと一緒にセルフホストすることで、プライバシーとパフォーマンスを向上させます。</p>
<p><strong>使い方 (Google Fonts):</strong></p>
<pre class="codehilite"><code class="language-tsx">// app/layout.tsx
import { Inter, Noto_Sans_JP } from &quot;next/font/google&quot;;

// フォント設定を定義
const inter = Inter({ subsets: [&quot;latin&quot;] });
const notoSansJP = Noto_Sans_JP({
  subsets: [&quot;latin&quot;],
  weight: [&quot;400&quot;, &quot;700&quot;],
  display: &quot;swap&quot;,
});

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    // &lt;html&gt;タグや&lt;body&gt;タグにclassNameを適用する
    &lt;html lang=&quot;ja&quot; className={notoSansJP.className}&gt;
      &lt;body&gt;{children}&lt;/body&gt;
    &lt;/html&gt;
  );
}
</code></pre>

<p>これだけで、Next.jsは以下の最適化を行います。</p>
<ul>
<li><strong>自動セルフホスティング</strong>: ビルド時にGoogle Fontsからフォントファイルをダウンロードし、アプリケーションと一緒に配信します。これにより、ブラウザがGoogleのサーバーにリクエストを送る必要がなくなり、プライバシーが保護され、パフォーマンスも安定します。</li>
<li><strong>レイアウトシフトの防止</strong>: フォントのメトリクス（サイズ情報）に基づいて、フォールバックフォントのスタイルを自動調整するCSSを生成します。これにより、カスタムフォントの読み込み前後でのレイアウトのズレ（CLS）がゼロになります。</li>
</ul>
<h3 id="3-nextdynamic">3. 動的インポート: <code>next/dynamic</code></h3>
<p>アプリケーションが大きくなると、JavaScriptのバンドルサイズも肥大化し、初期読み込みに時間がかかるようになります。しかし、すべてのコンポーネントがページの初期表示に必要というわけではありません。</p>
<p><code>next/dynamic</code>を使うと、特定のコンポーネントを初期バンドルから除外し、必要になったタイミング（例: クリックされた時、ビューポートに入った時）で動的に（遅延して）読み込むことができます。</p>
<p><strong>使い方:</strong></p>
<p>例えば、クリックしないと表示されないモーダルコンポーネントや、ページのフッター近くにあるような重いコンポーネントが対象になります。</p>
<pre class="codehilite"><code class="language-tsx">import { useState } from &quot;react&quot;;
import dynamic from &quot;next/dynamic&quot;;

// HeavyComponentを動的にインポート
const HeavyComponent = dynamic(() =&gt; import(&quot;../components/HeavyComponent&quot;), {
  // オプション: 読み込み中に表示するコンポーネント
  loading: () =&gt; &lt;p&gt;Loading...&lt;/p&gt;,
  // オプション: サーバーサイドレンダリングを無効化
  ssr: false,
});

export default function MyPage() {
  const [show, setShow] = useState(false);

  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; setShow(true)}&gt;Show Heavy Component&lt;/button&gt;
      {/* showがtrueになった時に初めてHeavyComponentのJSが読み込まれる */}
      {show &amp;&amp; &lt;HeavyComponent /&gt;}
    &lt;/div&gt;
  );
}
</code></pre>

<ul>
<li><strong>コード分割</strong>: <code>HeavyComponent</code>とその依存関係は、別のJavaScriptファイル（チャンク）に分割され、初期読み込み時にはダウンロードされません。</li>
<li><strong>遅延読み込み</strong>: <code>show</code>が<code>true</code>になるまで、このチャンクは読み込まれません。これにより、初期ページのJavaScriptサイズが削減され、インタラクティブになるまでの時間（TTI）が短縮されます。</li>
</ul>
<h2 id="_4">✨ まとめ</h2>
<ul>
<li>Next.jsは、Webパフォーマンスを向上させるための強力な組み込み機能を提供している。</li>
<li><code>&lt;img&gt;</code>タグを<code>next/image</code>の<code>&lt;Image&gt;</code>コンポーネントに置き換えるだけで、画像のサイズ、フォーマット、読み込みタイミングが自動的に最適化され、レイアウトシフトも防止できる。</li>
<li><code>next/font</code>を使うことで、Webフォントを簡単にセルフホストでき、パフォーマンスとプライバシーを向上させつつ、フォントによるレイアウトシフトをなくすことができる。</li>
<li><code>next/dynamic</code>を使うことで、コンポーネント単位でコード分割と遅延読み込みを実装でき、初期JavaScriptバンドルサイズを削減して、ページの表示速度とインタラクティブ性を高めることができる。</li>
<li>これらの機能を積極的に活用することが、高速でユーザー体験の良いNext.jsアプリケーションを構築するための鍵となる。</li>
</ul>
</div>
<div class="section-nav">
<a href="tutorial09_Next.js_chapter03_レンダリングとパフォーマンス_9-3-2: キャッシュ戦略.html" class="prev">キャッシュ戦略</a>
<a href="tutorial09_Next.js_chapter03_レンダリングとパフォーマンス_9-3-4: Hydration Mismatch エラーの倒し方.html" class="next">Hydration Mismatch エラーの倒し方</a>
</div>

                </div>
            </div>
        </div>
        <footer>
            &copy; 2025 pro-contents
        </footer>
    </div>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 3 ãƒãƒ³ã‚ºã‚ªãƒ³: èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ | Laravelã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãŸã‚ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</title>
    <meta name="description" content="PHP/Laravelã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚’ç¿’å¾—ã™ã‚‹ãŸã‚ã®æ•™æ">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="outer">
        <header>
            <h1><a href="index.html">Laravelã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãŸã‚ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</a></h1>
            <p class="description">PHP/Laravelã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚’ç¿’å¾—ã™ã‚‹ãŸã‚ã®æ•™æ</p>
        </header>
        <div id="container">
            <aside>
                <div id="side-inner">
                    <div class="side-title">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ä¸€è¦§</div>
<div class="side"><ul>
<li><a href="tutorial01_é–‹ç™ºç’°å¢ƒã¨Webã®åŸºç¤å›ºã‚.html">Tutorial 1: é–‹ç™ºç’°å¢ƒã¨Webã®åŸºç¤å›ºã‚</a></li>
<li><a href="tutorial02_HTML_CSSåŸºç¤.html">Tutorial 2: HTML/CSSåŸºç¤</a></li>
<li><a href="tutorial03_Tailwind_CSSå¾¹åº•ç¿’å¾—.html">Tutorial 3: Tailwind CSSå¾¹åº•ç¿’å¾—</a></li>
<li><a href="tutorial04_JavaScript_åŸºç¤ã¨DOMæ“ä½œ.html">Tutorial 4: JavaScriptåŸºç¤ã¨DOMæ“ä½œ</a></li>
<li><a href="tutorial05_JavaScript_å¿œç”¨ã¨éåŒæœŸå‡¦ç†.html">Tutorial 5: JavaScriptå¿œç”¨ã¨éåŒæœŸå‡¦ç†</a></li>
<li><a href="tutorial06_TypeScriptå…¥é–€.html">Tutorial 6: TypeScriptå…¥é–€</a></li>
<li><a href="tutorial07_Reactå…¥é–€.html">Tutorial 7: Reactå…¥é–€</a></li>
<li><a href="tutorial08_Reactå¿œç”¨.html">Tutorial 8: Reactå¿œç”¨</a></li>
<li><a href="tutorial09_Next.js.html">Tutorial 9: Next.js</a></li>
<li><a href="tutorial10_Laravel_x_Next.js.html" class="current">Tutorial 10: Laravel Ã— Next.js</a></li>
<li><a href="tutorial11_ãƒ†ã‚¹ãƒˆ.html">Tutorial 11: ãƒ†ã‚¹ãƒˆ</a></li>
<li><a href="tutorial12_column.html">ä¸Šç´šã‚³ãƒ©ãƒ : Webãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®æ·±å±¤ç†è§£</a></li>
</ul></div>

                </div>
            </aside>
            <div id="content">
                <div class="inner">
                    <div class="breadcrumb"><a href="index.html">ãƒ›ãƒ¼ãƒ </a><span>></span><a href="tutorial10_Laravel_x_Next.js.html">Tutorial 10: Laravel Ã— Next.js</a><span>></span><a href="tutorial10_Laravel_x_Next.js_chapter03_èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£….html">Chapter 3: èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…</a><span>></span>Chapter 3 ãƒãƒ³ã‚ºã‚ªãƒ³: èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹</div>
                    <div class="section-content">
<h1 id="10-3-4-chapter-3">10-3-4: Chapter 3 ãƒãƒ³ã‚ºã‚ªãƒ³: èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹</h1>
<h2 id="_1">ğŸ¯ ã“ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§ä½œã‚‹ã‚‚ã®</h2>
<p>ã“ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§ã¯ã€Laravel Sanctumã¨NextAuth.jsã‚’ä½¿ã£ã¦ã€<strong>ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã®èªè¨¼æ©Ÿèƒ½</strong>ã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p>
<p><strong>å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸:</strong><br />
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰<br />
- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ï¼‰<br />
- èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã®ä¿è­·<br />
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½</p>
<h2 id="_2">å‰ææ¡ä»¶</h2>
<ul>
<li>Chapter 1ã§æ§‹ç¯‰ã—ãŸé–‹ç™ºç’°å¢ƒï¼ˆLaravel Sail + Next.jsï¼‰ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨</li>
<li>Chapter 2ã§ä½œæˆã—ãŸå•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ãŒå®Œæˆã—ã¦ã„ã‚‹ã“ã¨</li>
<li>10-3-1ã€œ10-3-3ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Œäº†ã—ã¦ã„ã‚‹ã“ã¨</li>
</ul>
<h2 id="step-1-laravelapi">Step 1: Laravelå´ã®èªè¨¼APIã‚’ç¢ºèª</h2>
<p>10-3-1ã§è¨­å®šã—ãŸLaravel Sanctumã®èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
<h3 id="11">1.1 ãƒ«ãƒ¼ãƒˆã®ç¢ºèª</h3>
<p><code>routes/api.php</code>ã«ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-php">&lt;?php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\AuthController;

// èªè¨¼ä¸è¦ã®ãƒ«ãƒ¼ãƒˆ
Route::post('/login', [AuthController::class, 'login']);
Route::post('/register', [AuthController::class, 'register']);

// èªè¨¼ãŒå¿…è¦ãªãƒ«ãƒ¼ãƒˆ
Route::middleware('auth:sanctum')-&gt;group(function () {
    Route::get('/user', function (Request $request) {
        return $request-&gt;user();
    });
    Route::post('/logout', [AuthController::class, 'logout']);
});
</code></pre>

<h3 id="12-authcontroller">1.2 AuthControllerã®ç¢ºèª</h3>
<p><code>app/Http/Controllers/AuthController.php</code>ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-php">&lt;?php

namespace App\Http\Controllers;

use App\Models\User;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\ValidationException;

class AuthController extends Controller
{
    public function login(Request $request)
    {
        $request-&gt;validate([
            'email' =&gt; 'required|email',
            'password' =&gt; 'required',
        ]);

        $user = User::where('email', $request-&gt;email)-&gt;first();

        if (!$user || !Hash::check($request-&gt;password, $user-&gt;password)) {
            throw ValidationException::withMessages([
                'email' =&gt; ['èªè¨¼æƒ…å ±ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚'],
            ]);
        }

        $token = $user-&gt;createToken('auth-token')-&gt;plainTextToken;

        return response()-&gt;json([
            'user' =&gt; $user,
            'token' =&gt; $token,
        ]);
    }

    public function logout(Request $request)
    {
        $request-&gt;user()-&gt;currentAccessToken()-&gt;delete();

        return response()-&gt;json(['message' =&gt; 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ']);
    }

    public function register(Request $request)
    {
        $request-&gt;validate([
            'name' =&gt; 'required|string|max:255',
            'email' =&gt; 'required|email|unique:users',
            'password' =&gt; 'required|min:8|confirmed',
        ]);

        $user = User::create([
            'name' =&gt; $request-&gt;name,
            'email' =&gt; $request-&gt;email,
            'password' =&gt; Hash::make($request-&gt;password),
        ]);

        $token = $user-&gt;createToken('auth-token')-&gt;plainTextToken;

        return response()-&gt;json([
            'user' =&gt; $user,
            'token' =&gt; $token,
        ]);
    }
}
</code></pre>

<h3 id="13">1.3 ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ</h3>
<p>Seederã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-bash"># Laravelã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹
docker compose exec laravel.test bash

# Seederã‚’å®Ÿè¡Œ
php artisan db:seed
</code></pre>

<p><code>database/seeders/DatabaseSeeder.php</code>ã«ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-php">&lt;?php

namespace Database\Seeders;

use App\Models\User;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Hash;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        User::create([
            'name' =&gt; 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
            'email' =&gt; 'test@example.com',
            'password' =&gt; Hash::make('password'),
        ]);
    }
}
</code></pre>

<h2 id="step-2-nextjs">Step 2: Next.jså´ã®èªè¨¼è¨­å®š</h2>
<h3 id="21-nextauthjs">2.1 NextAuth.jsã®è¨­å®šç¢ºèª</h3>
<p>10-3-2ã§è¨­å®šã—ãŸ<code>app/api/auth/[...nextauth]/route.ts</code>ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-typescript">import NextAuth from &quot;next-auth&quot;;
import CredentialsProvider from &quot;next-auth/providers/credentials&quot;;

const handler = NextAuth({
  providers: [
    CredentialsProvider({
      name: &quot;Credentials&quot;,
      credentials: {
        email: { label: &quot;Email&quot;, type: &quot;email&quot; },
        password: { label: &quot;Password&quot;, type: &quot;password&quot; },
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          return null;
        }

        try {
          const res = await fetch(`${process.env.LARAVEL_API_URL}/api/login`, {
            method: &quot;POST&quot;,
            headers: {
              &quot;Content-Type&quot;: &quot;application/json&quot;,
              Accept: &quot;application/json&quot;,
            },
            body: JSON.stringify({
              email: credentials.email,
              password: credentials.password,
            }),
          });

          if (!res.ok) {
            return null;
          }

          const data = await res.json();

          return {
            id: data.user.id,
            name: data.user.name,
            email: data.user.email,
            accessToken: data.token,
          };
        } catch (error) {
          console.error(&quot;Login error:&quot;, error);
          return null;
        }
      },
    }),
  ],
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.accessToken = user.accessToken;
        token.id = user.id;
      }
      return token;
    },
    async session({ session, token }) {
      session.accessToken = token.accessToken;
      session.user.id = token.id;
      return session;
    },
  },
  pages: {
    signIn: &quot;/login&quot;,
  },
});

export { handler as GET, handler as POST };
</code></pre>

<h3 id="22">2.2 å‹å®šç¾©ã®è¿½åŠ </h3>
<p><code>types/next-auth.d.ts</code>ã‚’ä½œæˆã—ã¦ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‹ã‚’æ‹¡å¼µã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-typescript">import &quot;next-auth&quot;;

declare module &quot;next-auth&quot; {
  interface Session {
    accessToken?: string;
    user: {
      id?: string;
      name?: string | null;
      email?: string | null;
    };
  }

  interface User {
    accessToken?: string;
  }
}

declare module &quot;next-auth/jwt&quot; {
  interface JWT {
    accessToken?: string;
    id?: string;
  }
}
</code></pre>

<h2 id="step-3">Step 3: ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ä½œæˆ</h2>
<h3 id="31">3.1 ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</h3>
<p><code>app/login/page.tsx</code>ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-tsx">&quot;use client&quot;;

import { useState } from &quot;react&quot;;
import { signIn } from &quot;next-auth/react&quot;;
import { useRouter } from &quot;next/navigation&quot;;

export default function LoginPage() {
  const router = useRouter();
  const [email, setEmail] = useState(&quot;&quot;);
  const [password, setPassword] = useState(&quot;&quot;);
  const [error, setError] = useState(&quot;&quot;);
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) =&gt; {
    e.preventDefault();
    setError(&quot;&quot;);
    setIsLoading(true);

    try {
      const result = await signIn(&quot;credentials&quot;, {
        email,
        password,
        redirect: false,
      });

      if (result?.error) {
        setError(&quot;ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“&quot;);
      } else {
        router.push(&quot;/&quot;);
        router.refresh();
      }
    } catch (error) {
      setError(&quot;ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ&quot;);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    &lt;div className=&quot;min-h-screen flex items-center justify-center bg-gray-100&quot;&gt;
      &lt;div className=&quot;bg-white p-8 rounded-lg shadow-md w-full max-w-md&quot;&gt;
        &lt;h1 className=&quot;text-2xl font-bold text-center mb-6&quot;&gt;ãƒ­ã‚°ã‚¤ãƒ³&lt;/h1&gt;

        {error &amp;&amp; (
          &lt;div className=&quot;bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4&quot;&gt;
            {error}
          &lt;/div&gt;
        )}

        &lt;form onSubmit={handleSubmit} className=&quot;space-y-4&quot;&gt;
          &lt;div&gt;
            &lt;label
              htmlFor=&quot;email&quot;
              className=&quot;block text-sm font-medium text-gray-700 mb-1&quot;
            &gt;
              ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
            &lt;/label&gt;
            &lt;input
              id=&quot;email&quot;
              type=&quot;email&quot;
              value={email}
              onChange={(e) =&gt; setEmail(e.target.value)}
              required
              className=&quot;w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500&quot;
              placeholder=&quot;test@example.com&quot;
            /&gt;
          &lt;/div&gt;

          &lt;div&gt;
            &lt;label
              htmlFor=&quot;password&quot;
              className=&quot;block text-sm font-medium text-gray-700 mb-1&quot;
            &gt;
              ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
            &lt;/label&gt;
            &lt;input
              id=&quot;password&quot;
              type=&quot;password&quot;
              value={password}
              onChange={(e) =&gt; setPassword(e.target.value)}
              required
              className=&quot;w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500&quot;
              placeholder=&quot;â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢&quot;
            /&gt;
          &lt;/div&gt;

          &lt;button
            type=&quot;submit&quot;
            disabled={isLoading}
            className=&quot;w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors&quot;
          &gt;
            {isLoading ? &quot;ãƒ­ã‚°ã‚¤ãƒ³ä¸­...&quot; : &quot;ãƒ­ã‚°ã‚¤ãƒ³&quot;}
          &lt;/button&gt;
        &lt;/form&gt;

        &lt;p className=&quot;mt-4 text-center text-sm text-gray-600&quot;&gt;
          ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆ: test@example.com / password
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>

<h2 id="step-4">Step 4: èªè¨¼çŠ¶æ…‹ã®è¡¨ç¤º</h2>
<h3 id="41">4.1 ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ</h3>
<p><code>components/Header.tsx</code>ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-tsx">&quot;use client&quot;;

import { useSession, signOut } from &quot;next-auth/react&quot;;
import Link from &quot;next/link&quot;;

export default function Header() {
  const { data: session, status } = useSession();

  return (
    &lt;header className=&quot;bg-white shadow&quot;&gt;
      &lt;div className=&quot;max-w-7xl mx-auto px-4 py-4 flex justify-between items-center&quot;&gt;
        &lt;Link href=&quot;/&quot; className=&quot;text-xl font-bold text-gray-800&quot;&gt;
          ECã‚µã‚¤ãƒˆ
        &lt;/Link&gt;

        &lt;nav className=&quot;flex items-center gap-4&quot;&gt;
          &lt;Link href=&quot;/products&quot; className=&quot;text-gray-600 hover:text-gray-800&quot;&gt;
            å•†å“ä¸€è¦§
          &lt;/Link&gt;

          {status === &quot;loading&quot; ? (
            &lt;span className=&quot;text-gray-400&quot;&gt;èª­ã¿è¾¼ã¿ä¸­...&lt;/span&gt;
          ) : session ? (
            &lt;div className=&quot;flex items-center gap-4&quot;&gt;
              &lt;span className=&quot;text-gray-600&quot;&gt;
                {session.user?.name}ã•ã‚“
              &lt;/span&gt;
              &lt;button
                onClick={() =&gt; signOut({ callbackUrl: &quot;/&quot; })}
                className=&quot;bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition-colors&quot;
              &gt;
                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
              &lt;/button&gt;
            &lt;/div&gt;
          ) : (
            &lt;Link
              href=&quot;/login&quot;
              className=&quot;bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors&quot;
            &gt;
              ãƒ­ã‚°ã‚¤ãƒ³
            &lt;/Link&gt;
          )}
        &lt;/nav&gt;
      &lt;/div&gt;
    &lt;/header&gt;
  );
}
</code></pre>

<h3 id="42-sessionprovider">4.2 SessionProviderã®è¨­å®š</h3>
<p><code>app/providers.tsx</code>ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-tsx">&quot;use client&quot;;

import { SessionProvider } from &quot;next-auth/react&quot;;

export default function Providers({ children }: { children: React.ReactNode }) {
  return &lt;SessionProvider&gt;{children}&lt;/SessionProvider&gt;;
}
</code></pre>

<h3 id="43">4.3 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ›´æ–°</h3>
<p><code>app/layout.tsx</code>ã‚’æ›´æ–°ã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-tsx">import type { Metadata } from &quot;next&quot;;
import { Inter } from &quot;next/font/google&quot;;
import &quot;./globals.css&quot;;
import Providers from &quot;./providers&quot;;
import Header from &quot;@/components/Header&quot;;

const inter = Inter({ subsets: [&quot;latin&quot;] });

export const metadata: Metadata = {
  title: &quot;ECã‚µã‚¤ãƒˆ&quot;,
  description: &quot;Laravel + Next.js ECã‚µã‚¤ãƒˆ&quot;,
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    &lt;html lang=&quot;ja&quot;&gt;
      &lt;body className={inter.className}&gt;
        &lt;Providers&gt;
          &lt;Header /&gt;
          &lt;main&gt;{children}&lt;/main&gt;
        &lt;/Providers&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}
</code></pre>

<h2 id="step-5">Step 5: èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã®ä¿è­·</h2>
<h3 id="51">5.1 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ä½œæˆ</h3>
<p><code>middleware.ts</code>ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-typescript">import { withAuth } from &quot;next-auth/middleware&quot;;

export default withAuth({
  pages: {
    signIn: &quot;/login&quot;,
  },
});

export const config = {
  matcher: [&quot;/dashboard/:path*&quot;, &quot;/profile/:path*&quot;],
};
</code></pre>

<h3 id="52">5.2 ä¿è­·ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã®ä½œæˆ</h3>
<p><code>app/dashboard/page.tsx</code>ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<pre class="codehilite"><code class="language-tsx">import { getServerSession } from &quot;next-auth&quot;;
import { redirect } from &quot;next/navigation&quot;;

export default async function DashboardPage() {
  const session = await getServerSession();

  if (!session) {
    redirect(&quot;/login&quot;);
  }

  return (
    &lt;div className=&quot;max-w-7xl mx-auto px-4 py-8&quot;&gt;
      &lt;h1 className=&quot;text-2xl font-bold mb-4&quot;&gt;ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰&lt;/h1&gt;
      &lt;div className=&quot;bg-white p-6 rounded-lg shadow&quot;&gt;
        &lt;p className=&quot;text-gray-600&quot;&gt;
          ã‚ˆã†ã“ãã€{session.user?.name}ã•ã‚“ï¼
        &lt;/p&gt;
        &lt;p className=&quot;text-gray-600 mt-2&quot;&gt;
          ã“ã®ãƒšãƒ¼ã‚¸ã¯èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>

<h2 id="step-6">Step 6: å‹•ä½œç¢ºèª</h2>
<h3 id="61">6.1 é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•</h3>
<pre class="codehilite"><code class="language-bash"># Laravelã®èµ·å‹•ï¼ˆDockerï¼‰
docker compose up -d

# Next.jsã®èµ·å‹•
cd frontend
npm run dev
</code></pre>

<h3 id="62">6.2 ç¢ºèªé …ç›®</h3>
<p>ä»¥ä¸‹ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align: left;">ç¢ºèªé …ç›®</th>
<th style="text-align: left;">æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹</td>
<td style="text-align: left;">ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹</td>
</tr>
<tr>
<td style="text-align: left;">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã§ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³</td>
<td style="text-align: left;">ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</td>
</tr>
<tr>
<td style="text-align: left;">ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹</td>
<td style="text-align: left;">ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã€Œãƒ­ã‚°ã‚¢ã‚¦ãƒˆã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹</td>
</tr>
<tr>
<td style="text-align: left;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</td>
<td style="text-align: left;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</td>
</tr>
<tr>
<td style="text-align: left;">æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§<code>/dashboard</code>ã«ã‚¢ã‚¯ã‚»ã‚¹</td>
<td style="text-align: left;">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</td>
</tr>
<tr>
<td style="text-align: left;">ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§<code>/dashboard</code>ã«ã‚¢ã‚¯ã‚»ã‚¹</td>
<td style="text-align: left;">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹</td>
</tr>
</tbody>
</table>
<h2 id="_3">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
<h3 id="_4">ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆ</h3>
<ol>
<li>
<p><strong>Laravel APIãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª</strong><br />
<code>bash
   curl http://localhost/api/login -X POST \
     -H "Content-Type: application/json" \
     -d '{"email":"test@example.com","password":"password"}'</code></p>
</li>
<li>
<p><strong>CORSã®è¨­å®šã‚’ç¢ºèª</strong><br />
<code>config/cors.php</code>ã§<code>allowed_origins</code>ã«Next.jsã®URLãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</p>
</li>
<li>
<p><strong>ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª</strong><br />
<code>.env.local</code>ã«<code>LARAVEL_API_URL</code>ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</p>
</li>
</ol>
<h3 id="_5">ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä¿æŒã•ã‚Œãªã„å ´åˆ</h3>
<ol>
<li>
<p><strong>NEXTAUTH_SECRETãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</strong><br />
<code>bash
   # .env.local
   NEXTAUTH_SECRET=your-secret-key
   NEXTAUTH_URL=http://localhost:3000</code></p>
</li>
<li>
<p><strong>ãƒ–ãƒ©ã‚¦ã‚¶ã®Cookieã‚’ç¢ºèª</strong><br />
   é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« â†’ Application â†’ Cookies ã§<code>next-auth.session-token</code>ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª</p>
</li>
</ol>
<h2 id="_6">âœ¨ ã¾ã¨ã‚</h2>
<p>ã“ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§ã¯ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚</p>
<ul>
<li><strong>Laravel Sanctum</strong>ã‚’ä½¿ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼API</li>
<li><strong>NextAuth.js</strong>ã‚’ä½¿ã£ãŸNext.jså´ã®èªè¨¼ç®¡ç†</li>
<li><strong>ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ </strong>ã®ä½œæˆ</li>
<li><strong>èªè¨¼çŠ¶æ…‹ã®è¡¨ç¤º</strong>ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰</li>
<li><strong>ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢</strong>ã«ã‚ˆã‚‹èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã®ä¿è­·</li>
</ul>
<p>ã“ã‚Œã§ã€Laravelã¨Next.jsã‚’é€£æºã—ãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬çš„ãªèªè¨¼æ©Ÿèƒ½ãŒå®Œæˆã—ã¾ã—ãŸã€‚</p>
<h2 id="_7">ğŸ“ å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ</h2>
<ul>
<li>[ ] Laravel Sanctumã§ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼APIã‚’ä½œæˆã§ãã‚‹</li>
<li>[ ] NextAuth.jsã§CredentialsProviderã‚’è¨­å®šã§ãã‚‹</li>
<li>[ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã€èªè¨¼å‡¦ç†ã‚’å®Ÿè£…ã§ãã‚‹</li>
<li>[ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ä½¿ã£ã¦èªè¨¼çŠ¶æ…‹ã‚’è¡¨ç¤ºã§ãã‚‹</li>
<li>[ ] ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã‚’ä¿è­·ã§ãã‚‹</li>
</ul>
<h2 id="_8">ğŸš€ ç™ºå±•èª²é¡Œ</h2>
<ul>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹</li>
<li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹</li>
<li>ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆGoogle, GitHubï¼‰ã‚’è¿½åŠ ã™ã‚‹</li>
<li>èªè¨¼ã‚¨ãƒ©ãƒ¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è©³ç´°åŒ–ã™ã‚‹</li>
</ul>
</div>
<div class="section-nav">
<a href="tutorial10_Laravel_x_Next.js_chapter03_èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…_10-3-3: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã®å®Ÿè£….html" class="prev">ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…</a>
<span></span>
</div>

                </div>
            </div>
        </div>
        <footer>
            &copy; 2025 Laravelã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãŸã‚ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
        </footer>
    </div>
</body>
</html>
